//
//  ____  _                           _
// / ___|| |_ __ _ _ __   ___  ___   (_)___  (*)
// \___ \| __/ _` | '_ \ / _ \/ __|  | / __|
//  ___) | || (_| | |_) |  __/\__ \_ | \__ \
// |____/ \__\__,_| .__/ \___||___(_)/ |___/
//              |_|              |__/
//
// (*) a (really) tiny Javascript MVC microframework
//
// (c) Hay Kranen < hay@bykr.org >
// Released under the terms of the MIT license
// < http://en.wikipedia.org/wiki/MIT_License >
//
// Stapes.js : http://hay.github.com/stapes

function checkInstallFirefoxOS(){"use strict";var e,t;e=[location.protocol,"//",location.host,location.pathname.replace("index.html",""),"manifest.webapp"].join(""),t=navigator.mozApps.checkInstalled(e),t.onerror=function(){alert("Error calling checkInstalled: "+t.error.name)},t.onsuccess=function(){var i;t.result||confirm("Do you want to install hyperion remote contorl on your device?")&&(i=navigator.mozApps.install(e),i.onsuccess=function(e){},i.onerror=function(){alert(i.error.name)})}}!function(){"use strict";var e=1;if(!Object.create)var t=function(){};var i=Array.prototype.slice,r={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(e){r.eventHandlers[e.guid][e.type]||(r.eventHandlers[e.guid][e.type]=[]),r.eventHandlers[e.guid][e.type].push({guid:e.guid,handler:e.handler,scope:e.scope,type:e.type})},addEventHandler:function(e,t,i){var n,s={};"string"==typeof e?(n=i||!1,s[e]=t):(n=t||!1,s=e);for(var o in s)for(var a=s[o],l=o.split(" "),c=0,d=l.length;c<d;c++){var h=l[c];r.addEvent.call(this,{guid:this._guid||this._.guid,handler:a,scope:n,type:h})}},addGuid:function(t,i){t._guid&&!i||(t._guid=e++,r.attributes[t._guid]={},r.eventHandlers[t._guid]={})},attr:function(e){return r.attributes[e]},clone:function(e){var t=r.typeOf(e);return"object"===t?r.extend({},e):"array"===t?e.slice(0):void 0},create:function(e){return Object.create?Object.create(e):(t.prototype=e,new t)},createSubclass:function(e,t){function i(){if(!(this instanceof i))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&r.addGuid(this,!0),o.apply(this,arguments)}e=e||{},t=t||!1;var s=e.superclass.prototype,o=e.hasOwnProperty("constructor")?e.constructor:function(){};t&&r.extend(s,n),i.prototype=r.create(s),i.prototype.constructor=i,r.extend(i,{extend:function(){return r.extendThis.apply(this,arguments)},parent:s,proto:function(){return r.extendThis.apply(this.prototype,arguments)},subclass:function(e){return e=e||{},e.superclass=this,r.createSubclass(e)}});for(var a in e)"constructor"!==a&&"superclass"!==a&&(i.prototype[a]=e[a]);return i},emitEvents:function(e,t,n,s){n=n||!1,s=s||this._guid;for(var o=i.call(r.eventHandlers[s][e]),a=0,l=o.length;a<l;a++){var c=r.extend({},o[a]),d=c.scope?c.scope:this;n&&(c.type=n),c.scope=d,c.handler.call(c.scope,t,c)}},extend:function(){for(var e=i.call(arguments),t=e.shift(),r=0,n=e.length;r<n;r++){var s=e[r];for(var o in s)t[o]=s[o]}return t},extendThis:function(){var e=i.call(arguments);return e.unshift(this),r.extend.apply(this,e)},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},removeAttribute:function(e,t){t=t||!1;for(var i=r.trim(e).split(" "),n=0,s=i.length;n<s;n++){var o=r.trim(i[n]);o&&(delete r.attr(this._guid)[o],t||(this.emit("change",o),this.emit("change:"+o),this.emit("remove",o),this.emit("remove:"+o)))}},removeEventHandler:function(e,t){var i=r.eventHandlers[this._guid];if(e&&t){if(!(i=i[e]))return;for(var n,s=0,o=i.length;s<o;s++)(n=i[s].handler)&&n===t&&(i.splice(s--,1),o--)}else e?delete i[e]:r.eventHandlers[this._guid]={}},setAttribute:function(e,t,i){i=i||!1;var n=this.has(e),s=r.attr(this._guid)[e];if(t!==s&&(r.attr(this._guid)[e]=t,!i)){this.emit("change",e),this.emit("change:"+e,t);var o={key:e,newValue:t,oldValue:s||null};this.emit("mutate",o),this.emit("mutate:"+e,o);var a=n?"update":"create";this.emit(a,e),this.emit(a+":"+e,t)}},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(e){return null===e||void 0===e?String(e):Object.prototype.toString.call(e).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(e,t,i){var n=this.get(e),s=r.typeOf(n);"object"!==s&&"array"!==s||(n=r.clone(n));var o=t.call(this,n,e);r.setAttribute.call(this,e,o,i||!1)}},n={emit:function(e,t){t=void 0===t?null:t;for(var i=e.split(" "),n=0,s=i.length;n<s;n++){var o=i[n];r.eventHandlers[-1].all&&r.emitEvents.call(this,"all",t,o,-1),r.eventHandlers[-1][o]&&r.emitEvents.call(this,o,t,o,-1),"number"==typeof this._guid&&(r.eventHandlers[this._guid].all&&r.emitEvents.call(this,"all",t,o),r.eventHandlers[this._guid][o]&&r.emitEvents.call(this,o,t))}},off:function(){r.removeEventHandler.apply(this,arguments)},on:function(){r.addEventHandler.apply(this,arguments)}};r.Module=function(){},r.Module.prototype={each:function(e,t){var i=r.attr(this._guid);for(var n in i){var s=i[n];e.call(t||this,s,n)}},extend:function(){return r.extendThis.apply(this,arguments)},filter:function(e){var t=[],i=r.attr(this._guid);for(var n in i)e.call(this,i[n],n)&&t.push(i[n]);return t},get:function(e){if("string"==typeof e)return this.has(e)?r.attr(this._guid)[e]:null;if("function"==typeof e){var t=this.filter(e);return t.length?t[0]:null}},getAll:function(){return r.clone(r.attr(this._guid))},getAllAsArray:function(){var e=[],t=r.attr(this._guid);for(var i in t){var n=t[i];"object"!==r.typeOf(n)||n.id||(n.id=i),e.push(n)}return e},has:function(e){return void 0!==r.attr(this._guid)[e]},map:function(e,t){var i=[];return this.each(function(r,n){i.push(e.call(t||this,r,n))},t||this),i},push:function(e,t){if("array"===r.typeOf(e))for(var i=0,n=e.length;i<n;i++)r.setAttribute.call(this,r.makeUuid(),e[i],t||!1);else r.setAttribute.call(this,r.makeUuid(),e,t||!1);return this},remove:function(e,t){return void 0===e?(r.attributes[this._guid]={},this.emit("change remove")):"function"==typeof e?this.each(function(i,n){e(i)&&r.removeAttribute.call(this,n,t)}):r.removeAttribute.call(this,e,t||!1),this},set:function(e,t,i){if("object"==typeof e)for(var n in e)r.setAttribute.call(this,n,e[n],t||!1);else r.setAttribute.call(this,e,t,i||!1);return this},size:function(){var e=0,t=r.attr(this._guid);for(var i in t)e++;return e},update:function(e,t,i){return"string"==typeof e?r.updateAttribute.call(this,e,t,i||!1):"function"==typeof e&&this.each(function(t,i){r.updateAttribute.call(this,i,e)}),this}};var s={_:r,extend:function(){return r.extendThis.apply(r.Module.prototype,arguments)},mixinEvents:function(e){return e=e||{},r.addGuid(e),r.extend(e,n)},on:function(){r.addEventHandler.apply(this,arguments)},subclass:function(e,t){return t=t||!1,e=e||{},e.superclass=t?function(){}:r.Module,r.createSubclass(e,!t)},version:"0.8.0"};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports.Stapes=s):"function"==typeof define&&define.amd?define("lib/stapes",[],function(){return s}):window.Stapes=s}(),function(){function e(e){var i={r:0,g:0,b:0},n=1,o=!1,a=!1;return"string"==typeof e&&(e=T(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(i=t(e.r,e.g,e.b),o=!0,a="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=H(e.s),e.v=H(e.v),i=s(e.h,e.s,e.v),o=!0,a="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=H(e.s),e.l=H(e.l),i=r(e.h,e.s,e.l),o=!0,a="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=S(n),{ok:o,format:e.format||a,r:D(255,I(i.r,0)),g:D(255,I(i.g,0)),b:D(255,I(i.b,0)),a:n}}function t(e,t,i){return{r:255*C(e,255),g:255*C(t,255),b:255*C(i,255)}}function i(e,t,i){e=C(e,255),t=C(t,255),i=C(i,255);var r,n,s=I(e,t,i),o=D(e,t,i),a=(s+o)/2;if(s==o)r=n=0;else{var l=s-o;switch(n=a>.5?l/(2-s-o):l/(s+o),s){case e:r=(t-i)/l+(t<i?6:0);break;case t:r=(i-e)/l+2;break;case i:r=(e-t)/l+4}r/=6}return{h:r,s:n,l:a}}function r(e,t,i){function r(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}var n,s,o;if(e=C(e,360),t=C(t,100),i=C(i,100),0===t)n=s=o=i;else{var a=i<.5?i*(1+t):i+t-i*t,l=2*i-a;n=r(l,a,e+1/3),s=r(l,a,e),o=r(l,a,e-1/3)}return{r:255*n,g:255*s,b:255*o}}function n(e,t,i){e=C(e,255),t=C(t,255),i=C(i,255);var r,n,s=I(e,t,i),o=D(e,t,i),a=s,l=s-o;if(n=0===s?0:l/s,s==o)r=0;else{switch(s){case e:r=(t-i)/l+(t<i?6:0);break;case t:r=(i-e)/l+2;break;case i:r=(e-t)/l+4}r/=6}return{h:r,s:n,v:a}}function s(e,t,i){e=6*C(e,360),t=C(t,100),i=C(i,100);var r=N.floor(e),n=e-r,s=i*(1-t),o=i*(1-n*t),a=i*(1-(1-n)*t),l=r%6;return{r:255*[i,o,s,s,a,i][l],g:255*[a,i,i,o,s,s][l],b:255*[s,s,a,i,i,o][l]}}function o(e,t,i,r){var n=[L(R(e).toString(16)),L(R(t).toString(16)),L(R(i).toString(16))];return r&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function a(e,t,i,r){return[L(A(r)),L(R(e).toString(16)),L(R(t).toString(16)),L(R(i).toString(16))].join("")}function l(e,t){t=0===t?0:t||10;var i=F(e).toHsl();return i.s-=t/100,i.s=x(i.s),F(i)}function c(e,t){t=0===t?0:t||10;var i=F(e).toHsl();return i.s+=t/100,i.s=x(i.s),F(i)}function d(e){return F(e).desaturate(100)}function h(e,t){t=0===t?0:t||10;var i=F(e).toHsl();return i.l+=t/100,i.l=x(i.l),F(i)}function u(e,t){t=0===t?0:t||10;var i=F(e).toRgb();return i.r=I(0,D(255,i.r-R(-t/100*255))),i.g=I(0,D(255,i.g-R(-t/100*255))),i.b=I(0,D(255,i.b-R(-t/100*255))),F(i)}function f(e,t){t=0===t?0:t||10;var i=F(e).toHsl();return i.l-=t/100,i.l=x(i.l),F(i)}function v(e,t){var i=F(e).toHsl(),r=(R(i.h)+t)%360;return i.h=r<0?360+r:r,F(i)}function p(e){var t=F(e).toHsl();return t.h=(t.h+180)%360,F(t)}function m(e){var t=F(e).toHsl(),i=t.h;return[F(e),F({h:(i+120)%360,s:t.s,l:t.l}),F({h:(i+240)%360,s:t.s,l:t.l})]}function g(e){var t=F(e).toHsl(),i=t.h;return[F(e),F({h:(i+90)%360,s:t.s,l:t.l}),F({h:(i+180)%360,s:t.s,l:t.l}),F({h:(i+270)%360,s:t.s,l:t.l})]}function b(e){var t=F(e).toHsl(),i=t.h;return[F(e),F({h:(i+72)%360,s:t.s,l:t.l}),F({h:(i+216)%360,s:t.s,l:t.l})]}function w(e,t,i){t=t||6,i=i||30;var r=F(e).toHsl(),n=360/i,s=[F(e)];for(r.h=(r.h-(n*t>>1)+720)%360;--t;)r.h=(r.h+n)%360,s.push(F(r));return s}function y(e,t){t=t||6;for(var i=F(e).toHsv(),r=i.h,n=i.s,s=i.v,o=[],a=1/t;t--;)o.push(F({h:r,s:n,v:s})),s=(s+a)%1;return o}function S(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function C(e,t){_(e)&&(e="100%");var i=E(e);return e=D(t,I(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),N.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function x(e){return D(1,I(0,e))}function k(e){return parseInt(e,16)}function _(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)}function E(e){return"string"==typeof e&&-1!=e.indexOf("%")}function L(e){return 1==e.length?"0"+e:""+e}function H(e){return e<=1&&(e=100*e+"%"),e}function A(e){return Math.round(255*parseFloat(e)).toString(16)}function M(e){return k(e)/255}function T(e){e=e.replace(V,"").replace(q,"").toLowerCase();var t=!1;if(O[e])e=O[e],t=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=U.rgb.exec(e))?{r:i[1],g:i[2],b:i[3]}:(i=U.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=U.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=U.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=U.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=U.hex8.exec(e))?{a:M(i[1]),r:k(i[2]),g:k(i[3]),b:k(i[4]),format:t?"name":"hex8"}:(i=U.hex6.exec(e))?{r:k(i[1]),g:k(i[2]),b:k(i[3]),format:t?"name":"hex"}:!!(i=U.hex3.exec(e))&&{r:k(i[1]+""+i[1]),g:k(i[2]+""+i[2]),b:k(i[3]+""+i[3]),format:t?"name":"hex"}}var V=/^[\s,#]+/,q=/\s+$/,P=0,N=Math,R=N.round,D=N.min,I=N.max,B=N.random,F=function t(i,r){if(i=i||"",r=r||{},i instanceof t)return i;if(!(this instanceof t))return new t(i,r);var n=e(i);this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=R(100*this._a)/100,this._format=r.format||n.format,this._gradientType=r.gradientType,this._r<1&&(this._r=R(this._r)),this._g<1&&(this._g=R(this._g)),this._b<1&&(this._b=R(this._b)),this._ok=n.ok,this._tc_id=P++};F.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=S(e),this._roundA=R(100*this._a)/100,this},toHsv:function(){var e=n(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=n(this._r,this._g,this._b),t=R(360*e.h),i=R(100*e.s),r=R(100*e.v);return 1==this._a?"hsv("+t+", "+i+"%, "+r+"%)":"hsva("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=i(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=i(this._r,this._g,this._b),t=R(360*e.h),r=R(100*e.s),n=R(100*e.l);return 1==this._a?"hsl("+t+", "+r+"%, "+n+"%)":"hsla("+t+", "+r+"%, "+n+"%, "+this._roundA+")"},toHex:function(e){return o(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return a(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:R(this._r),g:R(this._g),b:R(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+R(this._r)+", "+R(this._g)+", "+R(this._b)+")":"rgba("+R(this._r)+", "+R(this._g)+", "+R(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:R(100*C(this._r,255))+"%",g:R(100*C(this._g,255))+"%",b:R(100*C(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+R(100*C(this._r,255))+"%, "+R(100*C(this._g,255))+"%, "+R(100*C(this._b,255))+"%)":"rgba("+R(100*C(this._r,255))+"%, "+R(100*C(this._g,255))+"%, "+R(100*C(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(G[o(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+a(this._r,this._g,this._b,this._a),i=t,r=this._gradientType?"GradientType = 1, ":"";if(e){i=F(e).toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1,r=this._a<1&&this._a>=0;return t||!r||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"name"!==e?("rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"hex8"===e&&(i=this.toHex8String()),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),"hsv"===e&&(i=this.toHsvString()),i||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(h,arguments)},brighten:function(){return this._applyModification(u,arguments)},darken:function(){return this._applyModification(f,arguments)},desaturate:function(){return this._applyModification(l,arguments)},saturate:function(){return this._applyModification(c,arguments)},greyscale:function(){return this._applyModification(d,arguments)},spin:function(){return this._applyModification(v,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(w,arguments)},complement:function(){return this._applyCombination(p,arguments)},monochromatic:function(){return this._applyCombination(y,arguments)},splitcomplement:function(){return this._applyCombination(b,arguments)},triad:function(){return this._applyCombination(m,arguments)},tetrad:function(){return this._applyCombination(g,arguments)}},F.fromRatio=function(e,t){if("object"==typeof e){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]="a"===r?e[r]:H(e[r]));e=i}return F(e,t)},F.equals=function(e,t){return!(!e||!t)&&F(e).toRgbString()==F(t).toRgbString()},F.random=function(){return F.fromRatio({r:B(),g:B(),b:B()})},F.mix=function(e,t,i){i=0===i?0:i||50;var r,n=F(e).toRgb(),s=F(t).toRgb(),o=i/100,a=2*o-1,l=s.a-n.a;r=a*l==-1?a:(a+l)/(1+a*l),r=(r+1)/2;var c=1-r,d={r:s.r*r+n.r*c,g:s.g*r+n.g*c,b:s.b*r+n.b*c,a:s.a*o+n.a*(1-o)};return F(d)},F.readability=function(e,t){var i=F(e),r=F(t),n=i.toRgb(),s=r.toRgb(),o=i.getBrightness(),a=r.getBrightness(),l=Math.max(n.r,s.r)-Math.min(n.r,s.r)+Math.max(n.g,s.g)-Math.min(n.g,s.g)+Math.max(n.b,s.b)-Math.min(n.b,s.b);return{brightness:Math.abs(o-a),color:l}},F.isReadable=function(e,t){var i=F.readability(e,t);return i.brightness>125&&i.color>500},F.mostReadable=function(e,t){for(var i=null,r=0,n=!1,s=0;s<t.length;s++){var o=F.readability(e,t[s]),a=o.brightness>125&&o.color>500,l=o.brightness/125*3+o.color/500;(a&&!n||a&&n&&l>r||!a&&!n&&l>r)&&(n=a,r=l,i=F(t[s]))}return i};var O=F.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},G=F.hexNames=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}(O),U=function(){var e="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",t="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?",i="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?";return{rgb:new RegExp("rgb"+t),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+t),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+t),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();"undefined"!=typeof module&&module.exports?module.exports=F:"function"==typeof define&&define.amd?define("lib/tinycolor",[],function(){return F}):window.tinycolor=F}(),define("utils/Tools",[],function(){"use strict";return{str2ab:function(e){var t,i=new ArrayBuffer(e.length),r=new Uint8Array(i);for(t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return i},a2ab:function(e){return new Uint8Array(e).buffer},ab2hexstr:function(e){var t,i="",r=new Uint8Array(e);for(t=0;t<r.length;t++)i+=this.b2hexstr(r[t]);return i},b2hexstr:function(e){return("00"+e.toString(16)).substr(-2)},ab2str:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}),define("views/Slider",["lib/stapes"],function(e){"use strict";function t(e){var t=100*(e.value-e.min)/(e.max-e.min);e.dom.lastElementChild.style.left=t+"%"}function i(e,t){var i,r,n,s,o;i=e.touches?e.touches[0].clientX:e.clientX,r=i-t.dom.getBoundingClientRect().left,n=r/t.dom.offsetWidth,s=(t.max-t.min)*n,o=(s-t.min)%t.step,o<=t.step/2?s-=o:s+=t.step-o,s=Math.max(s,t.min),s=Math.min(s,t.max),t.value=s,t.emit("changeValue",{value:s,target:t.dom})}return e.subclass({dom:null,min:0,max:100,value:0,step:1,constructor:function(e){this.dom=e.element,this.setValue(e.value),this.setMin(e.min),this.setMax(e.max),this.setStep(e.step),this.bindEventHandlers()},bindEventHandlers:function(){function e(e){n.drag&&(i(e,n),t(n),e.preventDefault())}function r(){n.drag=!1,t(n),window.removePointerMoveHandler(document,e),window.removePointerUpHandler(document,r)}var n=this;window.addPointerDownHandler(this.dom,function(n){this.drag=!0,i(n,this),t(this),window.addPointerMoveHandler(document,e),window.addPointerUpHandler(document,r)}.bind(this))},setValue:function(e){this.value=e||0,t(this)},setMin:function(e){this.min=e||0,t(this)},setMax:function(e){this.max=e||100,t(this)},setStep:function(e){this.step=e||1,t(this)}})}),define("views/MainView",["lib/stapes","lib/tinycolor","utils/Tools","views/Slider"],function(e,t,i,r){"use strict";function n(e,t){var i,r;i=document.querySelector(".work .msg"),i||(i=document.createElement("div"),i.classList.add("msg"),i.classList.add(t),r=document.createElement("div"),r.classList.add("wrapper_msg"),r.classList.add("invisible"),r.appendChild(i),document.querySelector(".work").appendChild(r),setTimeout(function(){r.classList.remove("invisible")},0)),i.classList.contains(t)||(i.className="msg",i.classList.add(t)),i.innerHTML=e,s&&clearTimeout(s),s=setTimeout(function(){var e=document.querySelector(".work .wrapper_msg");e&&e.parentNode.removeChild(e)},1600)}var s;return e.subclass({pointer:null,colorpicker:null,slider:null,sliderinput:null,cpradius:0,cpcenter:0,drag:!1,color:null,brightness:1,inputbox:null,constructor:function(){var e;this.pointer=document.querySelector("#colorpicker #pointer"),this.colorpicker=document.querySelector("#colorpicker #colorwheelbg"),this.slider=new r({element:document.getElementById("brightness"),min:0,max:1,step:.02,value:1}),this.inputbox=document.querySelector("#color input.value"),this.cpradius=this.colorpicker.offsetWidth/2,this.cpcenter=this.colorpicker.offsetLeft+this.cpradius,this.bindEventHandlers(),e=document.createEvent("Event"),e.initEvent("resize",!0,!0),window.dispatchEvent(e)},bindEventHandlers:function(){var e;window.addEventListener("resize",function(){var e,t,i,r=this.colorpicker.parentNode.clientWidth,n=this.colorpicker.parentNode.clientHeight;e=this.colorpicker.getAttribute("width"),t=this.colorpicker.getAttribute("height"),i="auto"===e?t:e,r>n?t!==i&&(this.colorpicker.setAttribute("height",i),this.colorpicker.setAttribute("width","auto")):e!==i&&(this.colorpicker.setAttribute("height","auto"),this.colorpicker.setAttribute("width",i)),this.cpradius=this.colorpicker.offsetWidth/2,this.cpcenter=this.colorpicker.offsetLeft+this.cpradius,this.color&&this.updatePointer()}.bind(this)),window.addClickHandler(document.querySelector(".footer"),function(e){this.emit("barClick",e.target.parentNode.dataset.area)}.bind(this)),this.slider.on("changeValue",function(e){this.brightness=e.value,this.updateInput(),this.fireColorEvent()},this),this.inputbox.addEventListener("input",function(e){var i,r=new t(e.target.value).toRgb();0===r.r&&0===r.g&&0===r.b?(this.brightness=0,this.color=new t({r:255,g:255,b:255})):(i=Math.max(r.r,r.g,r.b)/256,r.r=Math.round(r.r/i),r.g=Math.round(r.g/i),r.b=Math.round(r.b/i),this.brightness=i,this.color=new t(r)),this.fireColorEvent(),this.updatePointer(),this.updateSlider()}.bind(this),!1),this.inputbox.addEventListener("keydown",function(e){switch(e.keyCode){case 8:case 9:case 16:case 37:case 38:case 39:case 40:case 46:break;default:e.target.value.length>=6&&e.target.selectionEnd-e.target.selectionStart==0?(e.preventDefault(),e.stopPropagation()):(e.keyCode<48||e.keyCode>71)&&(e.preventDefault(),e.stopPropagation())}}),e=document.querySelector("#colorpicker .touchrect"),window.addPointerDownHandler(e,function(e){this.leaveInput(),this.drag=!0,this.handleEvent(e)}.bind(this)),window.addPointerMoveHandler(e,function(e){this.drag&&(this.handleEvent(e),e.preventDefault())}.bind(this)),window.addPointerUpHandler(e,function(){this.drag=!1}.bind(this)),window.addClickHandler(document.querySelector("#clear_button"),function(){this.emit("clear")}.bind(this)),window.addClickHandler(document.querySelector("#clearall_button"),function(){this.emit("clearall")}.bind(this))},handleEvent:function(e){var t,i,r;e.touches?(i=e.touches[0].clientX,r=e.touches[0].clientY):(i=e.clientX,r=e.clientY),t=this.getCirclePoint(i,r),this.color=this.getColorFromPoint(t),this.updatePointer(),this.updateSlider(),this.updateInput(),this.fireColorEvent()},getCirclePoint:function(e,t){var i,r={x:e,y:t},n={x:this.colorpicker.offsetLeft+this.cpradius,y:this.colorpicker.offsetTop+this.cpradius};return i=Math.sqrt(Math.pow(e-n.x,2)+Math.pow(t-n.y,2)),i>this.cpradius&&(r.x=n.x+this.cpradius*((e-n.x)/i),r.y=n.y+this.cpradius*((t-n.y)/i)),r},getColorFromPoint:function(e){var i,r,n,s,o;return s=e.x-this.colorpicker.offsetLeft-this.cpradius,o=this.cpradius-e.y+this.colorpicker.offsetTop,r=Math.atan2(o,s),i=(r*(180/Math.PI)+360)%360,n=Math.min(Math.sqrt(s*s+o*o)/this.cpradius,1),new t({h:i,s:n,v:1})},getPointFromColor:function(e){var t,i,r,n={};return t=e.h*(Math.PI/180),r=Math.sin(t)*this.cpradius*e.s,i=Math.cos(t)*this.cpradius*e.s,n.x=Math.round(i+this.colorpicker.offsetLeft+this.cpradius),n.y=Math.round(this.cpradius-r+this.colorpicker.offsetTop),n},fireColorEvent:function(){var e=this.color.toRgb();e.r=Math.round(e.r*this.brightness),e.g=Math.round(e.g*this.brightness),e.b=Math.round(e.b*this.brightness),this.emit("colorChange",e)},setColor:function(e){var i;0===e.r&&0===e.g&&0===e.b?(this.brightness=0,this.color=new t({r:255,g:255,b:255})):(i=Math.max(e.r,e.g,e.b)/256,e.r=Math.round(e.r/i),e.g=Math.round(e.g/i),e.b=Math.round(e.b/i),this.brightness=i,this.color=new t(e)),this.updatePointer(),this.updateSlider(),this.updateInput()},updateSlider:function(){this.slider.setValue(this.brightness),this.slider.dom.style.backgroundImage="-webkit-linear-gradient(left, #000000 0%, "+this.color.toHexString()+" 100%)"},updatePointer:function(){var e=this.getPointFromColor(this.color.toHsv());this.pointer.style.left=e.x-this.pointer.offsetWidth/2+"px",this.pointer.style.top=e.y-this.pointer.offsetHeight/2+"px",this.pointer.style.backgroundColor=this.color.toHexString()},updateInput:function(){var e=this.color.toRgb();e.r=Math.round(e.r*this.brightness),e.g=Math.round(e.g*this.brightness),e.b=Math.round(e.b*this.brightness),this.inputbox.value=i.b2hexstr(e.r)+i.b2hexstr(e.g)+i.b2hexstr(e.b)},scrollToArea:function(e){var t,i;document.querySelector(".footer .selected").classList.remove("selected"),document.querySelector(".footer .button[data-area ="+e+"]").classList.add("selected"),t=document.getElementById(e),i=Math.floor(t.offsetLeft/t.clientWidth),t.parentNode.style.left=100*-i+"%"},showStatus:function(e){n(e,"status")},showError:function(e){n(e,"error")},leaveInput:function(){this.inputbox.blur()}})}),define("api/LocalStorage",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){},get:function(){var e;if(!window.localStorage)return void this.emit("error","Local Storage not supported");localStorage.data&&(e=JSON.parse(localStorage.data),this.emit("got",e))},set:function(e){if(!window.localStorage)return void this.emit("error","Local Storage not supported");localStorage.data=JSON.stringify(e),this.emit("set")}})}),define("models/Settings",["lib/stapes","api/LocalStorage"],function(e,t){"use strict";return e.subclass({storage:null,servers:[],constructor:function(){this.storage=new t,this.storage.on({error:function(e){this.emit("error",e)},got:function(e){e&&(this.servers=e.servers||[]),this.emit("loaded")},set:function(){this.emit("saved")}},this)},save:function(){this.storage.set({servers:this.servers})},load:function(){this.storage.get()},addServer:function(e){-1===this.indexOfServer(e)&&(0===this.servers.length&&(e.selected=!0),this.servers.push(e),this.save(),this.emit("serverAdded",e))},setSelectedServer:function(e){var t;for(t=0;t<this.servers.length;t++)delete this.servers[t].selected;this.servers[e].selected=!0,this.save(),this.emit("serverChanged",this.servers[e])},removeServer:function(e){this.servers.splice(e,1),this.save(),this.emit("serverRemoved")},updateServer:function(e,t){e>=0&&e<this.servers.length&&(this.servers[e]=t,this.save(),this.emit("serverChanged",t))},indexOfServer:function(e){var t,i;for(t=0;t<this.servers.length;t++)if(i=this.servers[t],i.port===e.port&&i.address===e.address)return t;return-1}})}),define("views/ServerList",["lib/stapes"],function(e){"use strict";function t(e){var t,i,r,n,s;return t=document.createDocumentFragment(),r=document.createElement("div"),r.classList.add("horizontal"),t.appendChild(r),s=document.createElement("div"),s.classList.add("horizontal"),r.appendChild(s),i=document.createElement("div"),i.classList.add("checkbox"),s.appendChild(i),n=document.createElement("div"),n.classList.add("titlebox"),s.appendChild(n),i=document.createElement("label"),i.classList.add("title"),i.innerHTML=e.title||"",n.appendChild(i),i=document.createElement("label"),i.classList.add("subtitle"),i.innerHTML=e.subtitle,n.appendChild(i),i=document.createElement("div"),i.classList.add("touchrect"),s.appendChild(i),i=document.createElement("div"),i.classList.add("edit_icon"),i.innerHTML="&#xe801;",r.appendChild(i),i=document.createElement("div"),i.classList.add("delete_icon"),i.innerHTML="&#xe612;",r.appendChild(i),t}function i(e){var i,r,n,s,o,a;if(i=document.createElement("div"),i.classList.add("grouplist"),i.id=e.id,a=document.createElement("div"),a.classList.add("header"),i.appendChild(a),r=document.createElement("div"),r.innerHTML=e.label,r.classList.add("title"),a.appendChild(r),r=document.createElement("div"),r.innerHTML="&#xe804;",r.classList.add("callout"),a.appendChild(r),n=document.createElement("ul"),i.appendChild(n),e.list)for(o=0;o<e.list.length;o++)s=t(e.list[o]),n.appendChild(s);return i}return e.subclass({dom:null,constructor:function(e){this.dom=i(e||{}),this.bindEventHandlers()},bindEventHandlers:function(){window.addClickHandler(this.dom.querySelector(".callout"),function(){this.emit("add")}.bind(this)),window.addClickHandler(this.dom.querySelector("ul"),function(e){e.target.classList.contains("delete_icon")?this.emit("remove",e.target.parentNode.parentNode.id):e.target.classList.contains("edit_icon")?this.emit("edit",e.target.parentNode.parentNode.id):e.target.classList.contains("touchrect")&&this.emit("select",e.target.parentNode.parentNode.parentNode.id)}.bind(this))},getDom:function(){return this.dom},append:function(e,t,i){var r=document.createElement("li");r.id=e,t&&r.classList.add("selected"),r.appendChild(i),this.dom.querySelector("ul").appendChild(r)},replace:function(e,t){var i,r=this.dom.querySelector("ul li:nth-child("+(e+1)+")");r&&(i=document.createElement("li"),i.appendChild(t),this.dom.querySelector("ul").replaceChild(i,r))},addLine:function(e){var i=t(e);this.append(e.id,e.selected,i)},clear:function(){this.dom.querySelector("ul").innerHTML=""},showAddButton:function(e){
e?this.dom.querySelector(".callout").classList.remove("invisible"):this.dom.querySelector(".callout").classList.add("invisible")}})}),define("views/SettingsView",["lib/stapes","views/ServerList"],function(e,t){"use strict";function i(e){var t,i;return t=document.createElement("div"),t.classList.add("inputline"),t.id=e.id,i=document.createElement("label"),i.innerHTML=e.label,t.appendChild(i),i=document.createElement("input"),"number"==typeof e.value&&(i.type="number"),i.value=e.value||"",i.autocomplete="off",i.autocorrect="off",i.autocapitalize="off",t.appendChild(i),t}function r(e){var t,i;return t=document.createElement("div"),t.classList.add("inputline"),i=document.createElement("button"),i.innerHTML=e.label,i.classList.add("OK"),t.appendChild(i),i=document.createElement("button"),i.innerHTML="Cancel",i.classList.add("CANCEL"),t.appendChild(i),t}function n(){var e,t;return e=document.createElement("div"),e.classList.add("line"),t=document.createElement("button"),t.id="detect_button",t.innerHTML="Detect",e.appendChild(t),t=document.createElement("div"),t.classList.add("spinner"),t.classList.add("hidden"),e.appendChild(t),e}return e.subclass({dom:null,serverList:null,constructor:function(){var e,s=[];this.dom=document.querySelector("#settings"),this.serverList=new t({id:"serverList",label:"Server",list:s}),this.serverList.on({add:function(){var e,t;this.enableDetectButton(!1),this.lockList(!0),t=document.createDocumentFragment(),e=i({id:"name",label:"Name:"}),t.appendChild(e),e=i({id:"address",label:"Address:"}),t.appendChild(e),e=i({id:"port",label:"Port:",value:19444}),t.appendChild(e),e=i({id:"priority",label:"Priority:",value:50}),t.appendChild(e),e=i({id:"duration",label:"Duration (sec):",value:0}),t.appendChild(e),e=r({label:"Add"}),window.addClickHandler(e.firstChild,function(e){var t,i={},r=e.target.parentNode.parentNode.querySelectorAll("input");for(t=0;t<r.length;t++)i[r[t].parentNode.id]=r[t].value;i.port=parseInt(i.port),i.priority=parseInt(i.priority),i.duration=parseInt(i.duration),this.emit("serverAdded",i)}.bind(this)),window.addClickHandler(e.lastChild,function(){this.emit("serverAddCanceled")}.bind(this)),t.appendChild(e),this.serverList.append(null,!1,t)},select:function(e){this.dom.classList.contains("locked")||this.emit("serverSelected",parseInt(e.replace("server_","")))},remove:function(e){this.emit("serverRemoved",parseInt(e.replace("server_","")))},edit:function(e){this.emit("editServer",parseInt(e.replace("server_","")))}},this),this.dom.appendChild(this.serverList.getDom()),e=n(),window.addClickHandler(e.querySelector("button"),function(){this.emit("detect")}.bind(this)),this.dom.appendChild(e)},fillServerList:function(e){var t,i,r;for(this.serverList.clear(),t=0;t<e.length;t++)i=e[t],r={id:"server_"+t,title:i.name,subtitle:i.address+":"+i.port},i.selected&&(r.selected=!0),this.serverList.addLine(r);this.serverList.showAddButton(!0)},showWaiting:function(e){e?this.dom.querySelector(".spinner").classList.remove("hidden"):this.dom.querySelector(".spinner").classList.add("hidden")},enableDetectButton:function(e){e?this.dom.querySelector("#detect_button").classList.remove("hidden"):this.dom.querySelector("#detect_button").classList.add("hidden")},lockList:function(e){e?(this.dom.classList.add("locked"),this.serverList.showAddButton(!1)):(this.dom.classList.remove("locked"),this.serverList.showAddButton(!0))},editServer:function(e){var t,n;this.lockList(!0),this.enableDetectButton(!1),n=document.createDocumentFragment(),t=i({id:"name",label:"Name:",value:e.server.name}),n.appendChild(t),t=i({id:"address",label:"Address:",value:e.server.address}),n.appendChild(t),t=i({id:"port",label:"Port:",value:e.server.port}),n.appendChild(t),t=i({id:"priority",label:"Priority:",value:e.server.priority}),n.appendChild(t),t=i({id:"duration",label:"Duration (sec):",value:e.server.duration}),n.appendChild(t),t=r({label:"Done"}),window.addClickHandler(t.querySelector("button.OK"),function(t){var i,r={},n=t.target.parentNode.parentNode.querySelectorAll("input");for(i=0;i<n.length;i++)r[n[i].parentNode.id]=n[i].value;r.port=parseInt(r.port),r.priority=parseInt(r.priority),r.duration=parseInt(r.duration),e.server.selected&&(r.selected=!0),this.emit("serverChanged",{index:e.index,server:r})}.bind(this)),window.addClickHandler(t.querySelector("button.CANCEL"),function(){this.emit("serverEditCanceled")}.bind(this)),n.appendChild(t),window.addClickHandler(n.querySelector("input"),function(e){e.stopPropagation()}),this.serverList.replace(e.index,n)}})}),define("views/EffectsView",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){this.bindEventHandlers()},bindEventHandlers:function(){window.addClickHandler(document.querySelector("#effects ul"),function(e){var t=e.target.parentNode.querySelector(".selected");t&&t.classList.remove("selected"),e.target.classList.add("selected"),this.emit("effectSelected",e.target.dataset.id)}.bind(this))},clear:function(){document.querySelector("#effects ul").innerHTML="",document.querySelector("#effects .info").classList.add("hidden")},fillList:function(e){var t,i,r;for(t=document.createDocumentFragment(),r=0;r<e.length;r++)i=document.createElement("li"),i.innerHTML=e[r].name,i.dataset.id=e[r].id,t.appendChild(i);document.querySelector("#effects ul").appendChild(t),0===e.length&&document.querySelector("#effects .info").classList.remove("hidden")}})}),define("views/TransformView",["lib/stapes","views/Slider"],function(e,t){"use strict";function i(e){var t=e.target.parentNode.parentNode.querySelector("ul");0===t.clientHeight?(t.style.maxHeight=t.scrollHeight+"px",e.target.parentNode.parentNode.setAttribute("collapsed","false")):(t.style.maxHeight=0,e.target.parentNode.parentNode.setAttribute("collapsed","true"))}function r(e,t,i,r,n,s,o){var a,l,c,d,h;return a=document.createElement("li"),a.className=t,d=document.createElement("label"),d.innerHTML=r,a.appendChild(d),h=document.createElement("div"),h.classList.add("wrapper"),h.id=e,l=document.createElement("div"),l.classList.add("icon"),l.innerHTML=i,h.appendChild(l),l=document.createElement("div"),l.classList.add("slider"),c=document.createElement("div"),c.classList.add("track"),l.appendChild(c),c=document.createElement("div"),c.classList.add("thumb"),l.appendChild(c),l.dataset.min=s,l.dataset.max=o,l.dataset.value=n,l.dataset.step=.01,h.appendChild(l),l=document.createElement("input"),l.classList.add("value"),l.type="number",l.min=s,l.max=o,l.step=.01,l.value=parseFloat(Math.round(100*n)/100).toFixed(2),h.appendChild(l),a.appendChild(h),a}function n(e){var t,i,n,s,o;for(t=document.createElement("div"),t.classList.add("group"),e.collapsed&&t.setAttribute("collapsed","true"),t.id=e.id,i=document.createElement("div"),i.classList.add("header"),t.appendChild(i),n=document.createElement("label"),n.innerHTML=e.title,i.appendChild(n),n=document.createElement("label"),n.innerHTML=e.subtitle,i.appendChild(n),i=document.createElement("ul"),t.appendChild(i),s=0;s<e.members.length;s++)o=e.members[s],n=r(o.id,o.type,o.icon,o.label,o.value,o.min,o.max),i.appendChild(n);return t}return e.subclass({sliders:{},constructor:function(){},clear:function(){document.querySelector("#transform .values").innerHTML=""},onSliderChange:function(e){var t,i,r={};t=e.target.parentNode.id.split("_"),i=parseFloat(Math.round(100*parseFloat(e.value))/100),e.target.parentNode.querySelector(".value").value=i.toFixed(2),r[t[1]]=i,this.emit(t[0],r)},onValueChange:function(e){var t,i,r={};t=e.target.parentNode.id.split("_"),i=parseFloat(Math.round(100*parseFloat(e.target.value))/100),parseFloat(e.target.value)<parseFloat(e.target.min)?e.target.value=e.target.min:parseFloat(e.target.value)>parseFloat(e.target.max)&&(e.target.value=e.target.max),this.sliders[e.target.parentNode.id].setValue(i),r[t[1]]=i,this.emit(t[0],r)},fillList:function(e){var r,s,o,a,l;if(!e)return void document.querySelector("#transform .info").classList.remove("hidden");for(r=document.createDocumentFragment(),s=n({collapsed:!0,id:"HSV",title:"HSV",subtitle:"HSV color corrections",members:[{id:"hsv_saturationGain",type:"saturation",icon:"&#xe806;",label:"Saturation gain",value:e.saturationGain,min:0,max:5},{id:"hsv_valueGain",type:"value",icon:"&#xe805;",label:"Value gain",value:e.valueGain,min:0,max:5}]}),r.appendChild(s),s=n({collapsed:!0,id:"Gamma",title:"Gamma",subtitle:"Gamma correction",members:[{id:"gamma_r",type:"red",icon:"&#xe800;",label:"Red",value:e.gamma[0],min:0,max:5},{id:"gamma_g",type:"green",icon:"&#xe800;",label:"Green",value:e.gamma[1],min:0,max:5},{id:"gamma_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.gamma[2],min:0,max:5}]}),r.appendChild(s),s=n({collapsed:!0,id:"Whitelevel",title:"Whitelevel",subtitle:"Value when RGB channel is fully on",members:[{id:"whitelevel_r",type:"red",icon:"&#xe800;",label:"Red",value:e.whitelevel[0],min:0,max:1},{id:"whitelevel_g",type:"green",icon:"&#xe800;",label:"Green",value:e.whitelevel[1],min:0,max:1},{id:"whitelevel_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.whitelevel[2],min:0,max:1}]}),r.appendChild(s),s=n({collapsed:!0,id:"Blacklevel",title:"Blacklevel",subtitle:"Value when RGB channel is fully off",members:[{id:"blacklevel_r",type:"red",icon:"&#xe800;",label:"Red",value:e.blacklevel[0],min:0,max:1},{id:"blacklevel_g",type:"green",icon:"&#xe800;",label:"Green",value:e.blacklevel[1],min:0,max:1},{id:"blacklevel_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.blacklevel[2],min:0,max:1}]}),r.appendChild(s),s=n({collapsed:!0,id:"Threshold",title:"Threshold",subtitle:"Threshold for a channel",members:[{id:"threshold_r",type:"red",icon:"&#xe800;",label:"Red",value:e.threshold[0],min:0,max:1},{id:"threshold_g",type:"green",icon:"&#xe800;",label:"Green",value:e.threshold[1],min:0,max:1},{id:"threshold_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.threshold[2],min:0,max:1}]}),r.appendChild(s),o=r.querySelectorAll(".slider"),a=0;a<o.length;a++)l=new t({element:o[a],min:o[a].dataset.min,max:o[a].dataset.max,step:o[a].dataset.step,value:o[a].dataset.value}),l.on("changeValue",this.onSliderChange,this),this.sliders[o[a].parentNode.id]=l;for(o=r.querySelectorAll("input"),a=0;a<o.length;a++)o[a].addEventListener("input",this.onValueChange.bind(this),!1);for(o=r.querySelectorAll(".header"),a=0;a<o.length;a++)window.addClickHandler(o[a],i);document.querySelector("#transform .info").classList.add("hidden"),document.querySelector("#transform .values").appendChild(r)}})}),define("data/ServerControl",["lib/stapes","utils/Tools"],function(e,t){"use strict";return e.subclass({socket:null,server:null,connecting:!1,constructor:function(e,t){this.server=e,this.socket=new t,this.connecting=!1},connect:function(){this.server?(this.connecting=!0,this.socket.create(function(){this.socket.connect(this.server,function(){this.emit("connected"),this.connecting=!1}.bind(this),function(e){this.socket.close(),this.emit("error",e),this.connecting=!1}.bind(this))}.bind(this))):this.emit("error","Missing server info")},disconnect:function(){this.socket.close()},setColor:function(e,t){var i,r;i=[Math.floor(e.r),Math.floor(e.g),Math.floor(e.b)],r={command:"color",color:i,priority:this.server.priority},t&&(r.duration=1e3*t),this.sendCommand(r)},clear:function(){var e={command:"clear",priority:this.server.priority};this.sendCommand(e)},clearall:function(){var e={command:"clearall"};this.sendCommand(e)},runEffect:function(e){var t;e&&(t={command:"effect",effect:{name:e.name,args:e.args},priority:this.server.priority},this.sendCommand(t))},setTransform:function(e){var t;e&&(t={command:"transform",transform:e},this.sendCommand(t))},sendCommand:function(e){var t;e&&(t="string"==typeof e?e:JSON.stringify(e),this.socket.isConnected(function(i){i?this.socket.write(t+"\n",function(){this.emit("cmdSent",e)}.bind(this),function(e){this.emit("error",e)}.bind(this)):this.emit("error","No server connection")}.bind(this)))},getServerInfo:function(){var e={command:"serverinfo"};this.socket.isConnected(function(i){i?this.socket.write(JSON.stringify(e)+"\n",function(){this.socket.read(function(e){var i,r=t.ab2str(e);i=JSON.parse(r),this.emit("serverInfo",i.info)}.bind(this),function(e){this.emit("error",e)}.bind(this))}.bind(this),function(e){this.emit("error",e)}.bind(this)):this.emit("error","No server connection")}.bind(this))},isConnecting:function(){return this.connecting}})}),define("api/Socket",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){},create:function(e,t){},isConnected:function(){return!1},connect:function(e,t,i){},close:function(e,t){},read:function(e,t){},write:function(e,t,i){}},!0)}),define("api/WebSocket",["lib/stapes","api/Socket","utils/Tools"],function(e,t,i){"use strict";return t.subclass({DEBUG:!1,handle:null,currentResponseCallback:null,currentErrorCallback:null,inputBuffer:null,inputBufferIndex:0,readBufferTimerId:null,constructor:function(){this.inputBuffer=new Uint8Array(4096),this.inputBufferIndex=0},create:function(e,t){this.DEBUG,e&&e()},isConnected:function(e){if(this.DEBUG,!this.handle)return this.DEBUG,void(e&&e(!1));e&&e(this.handle.readyState===WebSocket.OPEN?!0:!1)},connect:function(e,t,i){this.DEBUG,this.currentErrorCallback=i,this.handle=new WebSocket("ws://"+e.address+":"+e.port),this.handle.onmessage=this.onDataReceived.bind(this),this.handle.onclose=function(){this.DEBUG}.bind(this),this.handle.onerror=function(){this.DEBUG,this.currentErrorCallback&&(this.currentErrorCallback("WebSocket error"),this.currentErrorCallback=null)}.bind(this),this.handle.onopen=function(){t&&t()}},close:function(e,t){this.DEBUG,this.handle?(this.handle.close(),e&&e()):(this.DEBUG,t&&t("Socket handle is invalid"))},write:function(e,t,i){var r=null;if(this.DEBUG,!this.handle)return this.DEBUG,void(i&&i("Socket handle is invalid"));this.isConnected(function(n){n?(this.DEBUG,r=e,this.currentErrorCallback=i,this.handle.send(r),t&&t()):i&&i("No connection to peer")}.bind(this))},read:function(e,t){if(this.DEBUG,!this.handle)return this.DEBUG,void(t&&t("Socket handle is invalid"));this.isConnected(function(e){e||(this.currentResponseCallback=null,this.currentErrorCallback=null,t&&t("No connection to peer"))}.bind(this)),e&&(this.currentResponseCallback=e),t&&(this.currentErrorCallback=t)},onDataReceived:function(e){this.DEBUG,this.handle&&e.data&&(this.DEBUG,this.currentResponseCallback&&(this.currentResponseCallback(i.str2ab(e.data)),this.currentResponseCallback=null))}},!0)}),define("api/Network",["lib/stapes"],function(e){"use strict";return e.subclass({detectTimerId:null,constructor:function(){},getLocalInterfaces:function(e,t){var i,r=[];i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection;var n=new i({iceServers:[]});n.onicecandidate=function(t){var i;this.detectTimerId&&clearTimeout(this.detectTimerId),t.candidate&&(i=t.candidate.candidate.split(" "),-1===r.indexOf(i[4])&&r.push(i[4])),this.detectTimerId=setTimeout(function(){e&&e(r)},200)}.bind(this),n.createDataChannel(""),n.createOffer(n.setLocalDescription.bind(n),t)},canDetectLocalAddress:function(){return window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection}},!0)}),define("controllers/AppController",["lib/stapes","views/MainView","models/Settings","views/SettingsView","views/EffectsView","views/TransformView","data/ServerControl","api/Socket","api/Network"],function(e,t,i,r,n,s,o,a,l){"use strict";var c=new l;return e.subclass({mainView:null,settingsView:null,effectsView:null,transformView:null,settings:null,serverControl:null,color:{r:255,g:255,b:255},effects:[],transform:{},selectedServer:null,constructor:function(){this.mainView=new t,this.settingsView=new r,this.effectsView=new n,this.transformView=new s,this.settings=new i,this.bindEventHandlers(),this.mainView.setColor(this.color),c.canDetectLocalAddress()||this.settingsView.enableDetectButton(!1)},init:function(){this.settings.load()},bindEventHandlers:function(){this.settings.on({loaded:function(){var e;for(e=0;e<this.settings.servers.length;e++)if(this.settings.servers[e].selected){this.selectedServer=this.settings.servers[e];break}this.settingsView.fillServerList(this.settings.servers),this.selectedServer?this.connectToServer(this.selectedServer):this.gotoArea("settings")},error:function(e){this.showError(e)},serverAdded:function(e){var t;for(t=0;t<this.settings.servers.length;t++)if(this.settings.servers[t].selected){this.selectedServer=this.settings.servers[t],this.connectToServer(e);break}this.settingsView.fillServerList(this.settings.servers)},serverChanged:function(e){var t;for(t=0;t<this.settings.servers.length;t++)if(this.settings.servers[t].selected){this.selectedServer=this.settings.servers[t],this.connectToServer(e);break}this.settingsView.fillServerList(this.settings.servers),this.connectToServer(e)},serverRemoved:function(){var e,t=!0;for(this.settingsView.fillServerList(this.settings.servers),e=0;e<this.settings.servers.length;e++)if(this.settings.servers[e].selected){t=!1;break}t&&(this.selectedServer=null,this.serverControl&&this.serverControl.disconnect(),this.effectsView.clear(),this.transformView.clear())}},this),this.mainView.on({barClick:function(e){"settings"!==e&&(this.selectedServer?this.serverControl||this.connectToServer(this.selectedServer):this.showError("No server selected")),this.gotoArea(e)},colorChange:function(e){this.color=e,this.selectedServer?this.serverControl?this.serverControl.setColor(e,this.selectedServer.duration):this.connectToServer(this.selectedServer,function(){this.serverControl.setColor(e,this.selectedServer.duration)}.bind(this)):this.showError("No server selected")},clear:function(){this.selectedServer?this.serverControl?this.serverControl.clear():this.connectToServer(this.selectedServer,function(){this.serverControl.clear()}.bind(this)):this.showError("No server selected")},clearall:function(){this.selectedServer?this.serverControl?(this.serverControl.clearall(),this.mainView.setColor({r:0,g:0,b:0})):this.connectToServer(this.selectedServer,function(){this.serverControl.clearall(),this.mainView.setColor({r:0,g:0,b:0})}.bind(this)):this.showError("No server selected")}},this),this.settingsView.on({serverAdded:function(e){e.address&&e.port?(e.priority=e.priority||50,this.settings.addServer(e),this.lockSettingsView(!1)):this.showError("Invalid server data")},serverAddCanceled:function(){this.lockSettingsView(!1),this.settingsView.fillServerList(this.settings.servers)},serverEditCanceled:function(){this.lockSettingsView(!1),this.settingsView.fillServerList(this.settings.servers)},serverSelected:function(e){this.lockSettingsView(!1),this.settings.setSelectedServer(e)},serverRemoved:function(e){this.settings.removeServer(e)},serverChanged:function(e){e.server.address&&e.server.port?(e.server.priority=e.server.priority||50,this.settings.updateServer(e.index,e.server),this.lockSettingsView(!1)):this.showError("Invalid server data")},editServer:function(e){var t=this.settings.servers[e];this.settingsView.editServer({index:e,server:t})},durationChanged:function(e){this.settings.duration=e,this.settings.save()},detect:function(){this.lockSettingsView(!0),this.settingsView.showWaiting(!0),this.searchForServer(function(e){this.settings.addServer(e)}.bind(this),function(){this.lockSettingsView(!1),this.settingsView.showWaiting(!1)}.bind(this))}},this),this.effectsView.on({effectSelected:function(e){this.serverControl?this.serverControl.runEffect(this.effects[parseInt(e)]):this.connectToServer(this.selectedServer,function(){this.serverControl.runEffect(this.effects[parseInt(e)])}.bind(this))}},this),this.transformView.on({gamma:function(e){e.r?this.transform.gamma[0]=e.r:e.g?this.transform.gamma[1]=e.g:e.b&&(this.transform.gamma[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},whitelevel:function(e){e.r?this.transform.whitelevel[0]=e.r:e.g?this.transform.whitelevel[1]=e.g:e.b&&(this.transform.whitelevel[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},blacklevel:function(e){e.r?this.transform.blacklevel[0]=e.r:e.g?this.transform.blacklevel[1]=e.g:e.b&&(this.transform.blacklevel[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},threshold:function(e){e.r?this.transform.threshold[0]=e.r:e.g?this.transform.threshold[1]=e.g:e.b&&(this.transform.threshold[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},hsv:function(e){e.valueGain?this.transform.valueGain=e.valueGain:e.saturationGain&&(this.transform.saturationGain=e.saturationGain),this.serverControl&&this.serverControl.setTransform(this.transform)}},this)},gotoArea:function(e){this.mainView.scrollToArea(e)},connectToServer:function(e,t){if(this.serverControl){if(this.serverControl.isConnecting())return;this.serverControl.off(),this.serverControl.disconnect(),this.transformView.clear(),this.effectsView.clear()}this.serverControl=new o(e,a),this.serverControl.on({connected:function(){this.serverControl.getServerInfo()},serverInfo:function(e){var i;this.selectedServer.name&&0!==this.selectedServer.name.length||(this.selectedServer.name=e.hostname,i=this.settings.indexOfServer(this.selectedServer),this.settings.updateServer(i,this.selectedServer),this.settingsView.fillServerList(this.settings.servers)),e.effects.sort(function(e,t){e.name.localeCompare(t.name)}),this.effects=e.effects,this.transform=e.transform[0],this.updateView(),this.showStatus("Connected to "+this.selectedServer.name),t&&t()},error:function(e){this.serverControl=null,this.showError(e)}},this),this.serverControl.connect()},updateView:function(){var e,t=[];if(this.effects)for(e=0;e<this.effects.length;e++)t.push({id:e,name:this.effects[e].name});this.effectsView.clear(),this.effectsView.fillList(t),this.transformView.clear(),this.transformView.fillList(this.transform)},showError:function(e){this.mainView.showError(e)},showStatus:function(e){this.mainView.showStatus(e)},lockSettingsView:function(e){c.canDetectLocalAddress()&&this.settingsView.enableDetectButton(!e),this.settingsView.lockList(e)},searchForServer:function(e,t){c.getLocalInterfaces(function(i){function r(t,i){function r(t,i,r){function n(n){var s,o;n&&e&&e(n),++h===i&&(s=t.split("."),s[3]=parseInt(s[3])+i,o=s.join("."),r(o))}var s,l,c,d,h=0;for(s=t.split("."),d=parseInt(s[3]),l=0;l<i;l++)s[3]=d+l,c=s.join("."),function(e,t,i){var r=new o({address:e,port:t},a);r.on({error:function(){r.disconnect(),i()},connected:function(){r.getServerInfo()},serverInfo:function(n){var s={address:e,port:t,priority:50};r.disconnect(),n.hostname&&(s.name=n.hostname),i(s)}}),r.connect()}(c,19444,n)}function n(e){var t,s,o=64;if(t=e.split("."),255===(s=parseInt(t[3])))return void i();s+64>254&&(o=255-s),r(e,o,n)}var s,l,c;s=1,l=t.split("."),l[3]=s,c=l.join("."),r(c,64,n)}function n(){0===i.length?t():r(i.pop(),n)}if(0===i.length)return void t();r(i.pop(),n)}.bind(this),function(e){this.showError(e)}.bind(this))}})}),requirejs.config({baseUrl:"js/app",paths:{lib:"../vendor"},map:{"controllers/AppController":{"api/Socket":"api/WebSocket"}}}),window.addPointerDownHandler=function(e,t){"use strict";e.addEventListener("touchstart",t,!1),e.addEventListener("mousedown",t,!1)},window.removePointerDownHandler=function(e,t){"use strict";e.removeEventListener("touchstart",t,!1),e.removeEventListener("mousedown",t,!1)},window.addPointerUpHandler=function(e,t){"use strict";e.addEventListener("touchend",t,!1),e.addEventListener("mouseup",t,!1)},window.removePointerUpHandler=function(e,t){"use strict";e.removeEventListener("touchend",t,!1),e.removeEventListener("mouseup",t,!1)},window.addPointerMoveHandler=function(e,t){"use strict";e.addEventListener("touchmove",t,!1),e.addEventListener("mousemove",t,!1)},window.removePointerMoveHandler=function(e,t){"use strict";e.removeEventListener("touchmove",t,!1),e.removeEventListener("mousemove",t,!1)},window.addClickHandler=function(e,t){"use strict";var i=!1;e.addEventListener("touchstart",function(e){e.touches.length>1||(i=!0)},!1),e.addEventListener("touchmove",function(){i=!1},!1),e.addEventListener("touchend",function(e){var r;i&&(t.apply(this,arguments),r=document.querySelector(":focus"),r&&e.target!==r&&r.blur(),"INPUT"!==e.target.tagName&&e.preventDefault())},!1),e.addEventListener("click",function(){t.apply(this,arguments)},!1)},require(["controllers/AppController"],function(e){"use strict";(new e).init(),navigator.mozApps&&-1!==navigator.userAgent.indexOf("Mozilla/5.0 (Mobile;")&&checkInstallFirefoxOS()}),define("main",function(){});