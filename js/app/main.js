//
//  ____  _                           _
// / ___|| |_ __ _ _ __   ___  ___   (_)___  (*)
// \___ \| __/ _` | '_ \ / _ \/ __|  | / __|
//  ___) | || (_| | |_) |  __/\__ \_ | \__ \
// |____/ \__\__,_| .__/ \___||___(_)/ |___/
//              |_|              |__/
//
// (*) a (really) tiny Javascript MVC microframework
//
// (c) Hay Kranen < hay@bykr.org >
// Released under the terms of the MIT license
// < http://en.wikipedia.org/wiki/MIT_License >
//
// Stapes.js : http://hay.github.com/stapes

/* axios v0.18.0 | (c) 2018 by Matt Zabriskie */

/*!
	 * Determine if an object is a Buffer
	 *
	 * @author   Feross Aboukhadijeh <https://feross.org>
	 * @license  MIT
	 */

function checkInstallFirefoxOS(){"use strict";var e,t;e=[location.protocol,"//",location.host,location.pathname.replace("index.html",""),"manifest.webapp"].join(""),t=navigator.mozApps.checkInstalled(e),t.onerror=function(){alert("Error calling checkInstalled: "+t.error.name)},t.onsuccess=function(){var n;t.result||confirm("Do you want to install hyperion remote contorl on your device?")&&(n=navigator.mozApps.install(e),n.onsuccess=function(e){},n.onerror=function(){alert(n.error.name)})}}!function(){"use strict";var e=1;if(!Object.create)var t=function(){};var n=Array.prototype.slice,r={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(e){r.eventHandlers[e.guid][e.type]||(r.eventHandlers[e.guid][e.type]=[]),r.eventHandlers[e.guid][e.type].push({guid:e.guid,handler:e.handler,scope:e.scope,type:e.type})},addEventHandler:function(e,t,n){var i,s={};"string"==typeof e?(i=n||!1,s[e]=t):(i=t||!1,s=e);for(var o in s)for(var a=s[o],c=o.split(" "),l=0,d=c.length;l<d;l++){var u=c[l];r.addEvent.call(this,{guid:this._guid||this._.guid,handler:a,scope:i,type:u})}},addGuid:function(t,n){t._guid&&!n||(t._guid=e++,r.attributes[t._guid]={},r.eventHandlers[t._guid]={})},attr:function(e){return r.attributes[e]},clone:function(e){var t=r.typeOf(e);return"object"===t?r.extend({},e):"array"===t?e.slice(0):void 0},create:function(e){return Object.create?Object.create(e):(t.prototype=e,new t)},createSubclass:function(e,t){function n(){if(!(this instanceof n))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&r.addGuid(this,!0),o.apply(this,arguments)}e=e||{},t=t||!1;var s=e.superclass.prototype,o=e.hasOwnProperty("constructor")?e.constructor:function(){};t&&r.extend(s,i),n.prototype=r.create(s),n.prototype.constructor=n,r.extend(n,{extend:function(){return r.extendThis.apply(this,arguments)},parent:s,proto:function(){return r.extendThis.apply(this.prototype,arguments)},subclass:function(e){return e=e||{},e.superclass=this,r.createSubclass(e)}});for(var a in e)"constructor"!==a&&"superclass"!==a&&(n.prototype[a]=e[a]);return n},emitEvents:function(e,t,i,s){i=i||!1,s=s||this._guid;for(var o=n.call(r.eventHandlers[s][e]),a=0,c=o.length;a<c;a++){var l=r.extend({},o[a]),d=l.scope?l.scope:this;i&&(l.type=i),l.scope=d,l.handler.call(l.scope,t,l)}},extend:function(){for(var e=n.call(arguments),t=e.shift(),r=0,i=e.length;r<i;r++){var s=e[r];for(var o in s)t[o]=s[o]}return t},extendThis:function(){var e=n.call(arguments);return e.unshift(this),r.extend.apply(this,e)},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},removeAttribute:function(e,t){t=t||!1;for(var n=r.trim(e).split(" "),i=0,s=n.length;i<s;i++){var o=r.trim(n[i]);o&&(delete r.attr(this._guid)[o],t||(this.emit("change",o),this.emit("change:"+o),this.emit("remove",o),this.emit("remove:"+o)))}},removeEventHandler:function(e,t){var n=r.eventHandlers[this._guid];if(e&&t){if(!(n=n[e]))return;for(var i,s=0,o=n.length;s<o;s++)(i=n[s].handler)&&i===t&&(n.splice(s--,1),o--)}else e?delete n[e]:r.eventHandlers[this._guid]={}},setAttribute:function(e,t,n){n=n||!1;var i=this.has(e),s=r.attr(this._guid)[e];if(t!==s&&(r.attr(this._guid)[e]=t,!n)){this.emit("change",e),this.emit("change:"+e,t);var o={key:e,newValue:t,oldValue:s||null};this.emit("mutate",o),this.emit("mutate:"+e,o);var a=i?"update":"create";this.emit(a,e),this.emit(a+":"+e,t)}},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(e){return null===e||void 0===e?String(e):Object.prototype.toString.call(e).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(e,t,n){var i=this.get(e),s=r.typeOf(i);"object"!==s&&"array"!==s||(i=r.clone(i));var o=t.call(this,i,e);r.setAttribute.call(this,e,o,n||!1)}},i={emit:function(e,t){t=void 0===t?null:t;for(var n=e.split(" "),i=0,s=n.length;i<s;i++){var o=n[i];r.eventHandlers[-1].all&&r.emitEvents.call(this,"all",t,o,-1),r.eventHandlers[-1][o]&&r.emitEvents.call(this,o,t,o,-1),"number"==typeof this._guid&&(r.eventHandlers[this._guid].all&&r.emitEvents.call(this,"all",t,o),r.eventHandlers[this._guid][o]&&r.emitEvents.call(this,o,t))}},off:function(){r.removeEventHandler.apply(this,arguments)},on:function(){r.addEventHandler.apply(this,arguments)}};r.Module=function(){},r.Module.prototype={each:function(e,t){var n=r.attr(this._guid);for(var i in n){var s=n[i];e.call(t||this,s,i)}},extend:function(){return r.extendThis.apply(this,arguments)},filter:function(e){var t=[],n=r.attr(this._guid);for(var i in n)e.call(this,n[i],i)&&t.push(n[i]);return t},get:function(e){if("string"==typeof e)return this.has(e)?r.attr(this._guid)[e]:null;if("function"==typeof e){var t=this.filter(e);return t.length?t[0]:null}},getAll:function(){return r.clone(r.attr(this._guid))},getAllAsArray:function(){var e=[],t=r.attr(this._guid);for(var n in t){var i=t[n];"object"!==r.typeOf(i)||i.id||(i.id=n),e.push(i)}return e},has:function(e){return void 0!==r.attr(this._guid)[e]},map:function(e,t){var n=[];return this.each(function(r,i){n.push(e.call(t||this,r,i))},t||this),n},push:function(e,t){if("array"===r.typeOf(e))for(var n=0,i=e.length;n<i;n++)r.setAttribute.call(this,r.makeUuid(),e[n],t||!1);else r.setAttribute.call(this,r.makeUuid(),e,t||!1);return this},remove:function(e,t){return void 0===e?(r.attributes[this._guid]={},this.emit("change remove")):"function"==typeof e?this.each(function(n,i){e(n)&&r.removeAttribute.call(this,i,t)}):r.removeAttribute.call(this,e,t||!1),this},set:function(e,t,n){if("object"==typeof e)for(var i in e)r.setAttribute.call(this,i,e[i],t||!1);else r.setAttribute.call(this,e,t,n||!1);return this},size:function(){var e=0,t=r.attr(this._guid);for(var n in t)e++;return e},update:function(e,t,n){return"string"==typeof e?r.updateAttribute.call(this,e,t,n||!1):"function"==typeof e&&this.each(function(t,n){r.updateAttribute.call(this,n,e)}),this}};var s={_:r,extend:function(){return r.extendThis.apply(r.Module.prototype,arguments)},mixinEvents:function(e){return e=e||{},r.addGuid(e),r.extend(e,i)},on:function(){r.addEventHandler.apply(this,arguments)},subclass:function(e,t){return t=t||!1,e=e||{},e.superclass=t?function(){}:r.Module,r.createSubclass(e,!t)},version:"0.8.0"};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports.Stapes=s):"function"==typeof define&&define.amd?define("lib/stapes",[],function(){return s}):window.Stapes=s}(),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("lib/axios",[],t):"object"==typeof exports?exports.axios=t():e.axios=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){var t=new o(e),n=s(o.prototype.request,t);return i.extend(n,o.prototype,t),i.extend(n,t),n}var i=n(2),s=n(3),o=n(5),a=n(6),c=r(a);c.Axios=o,c.create=function(e){return r(i.merge(a,e))},c.Cancel=n(23),c.CancelToken=n(24),c.isCancel=n(20),c.all=function(e){return Promise.all(e)},c.spread=n(25),e.exports=c,e.exports.default=c},function(e,t,n){"use strict";function r(e){return"[object Array]"===E.call(e)}function i(e){return"[object ArrayBuffer]"===E.call(e)}function s(e){return"undefined"!=typeof FormData&&e instanceof FormData}function o(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function a(e){return"string"==typeof e}function c(e){return"number"==typeof e}function l(e){return void 0===e}function d(e){return null!==e&&"object"==typeof e}function u(e){return"[object Date]"===E.call(e)}function h(e){return"[object File]"===E.call(e)}function f(e){return"[object Blob]"===E.call(e)}function p(e){return"[object Function]"===E.call(e)}function m(e){return d(e)&&p(e.pipe)}function v(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function g(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function b(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function w(e,t){if(null!==e&&void 0!==e)if("object"!=typeof e&&(e=[e]),r(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}function y(){function e(e,n){"object"==typeof t[n]&&"object"==typeof e?t[n]=y(t[n],e):t[n]=e}for(var t={},n=0,r=arguments.length;n<r;n++)w(arguments[n],e);return t}function x(e,t,n){return w(t,function(t,r){e[r]=n&&"function"==typeof t?S(t,n):t}),e}var S=n(3),C=n(4),E=Object.prototype.toString;e.exports={isArray:r,isArrayBuffer:i,isBuffer:C,isFormData:s,isArrayBufferView:o,isString:a,isNumber:c,isObject:d,isUndefined:l,isDate:u,isFile:h,isBlob:f,isFunction:p,isStream:m,isURLSearchParams:v,isStandardBrowserEnv:b,forEach:w,merge:y,extend:x,trim:g}},function(e,t){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},function(e,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function r(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}e.exports=function(e){return null!=e&&(n(e)||r(e)||!!e._isBuffer)}},function(e,t,n){"use strict";function r(e){this.defaults=e,this.interceptors={request:new o,response:new o}}var i=n(6),s=n(2),o=n(17),a=n(18);r.prototype.request=function(e){"string"==typeof e&&(e=s.merge({url:arguments[0]},arguments[1])),e=s.merge(i,{method:"get"},this.defaults,e),e.method=e.method.toLowerCase();var t=[a,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},s.forEach(["delete","get","head","options"],function(e){r.prototype[e]=function(t,n){return this.request(s.merge(n||{},{method:e,url:t}))}}),s.forEach(["post","put","patch"],function(e){r.prototype[e]=function(t,n,r){return this.request(s.merge(r||{},{method:e,url:t,data:n}))}}),e.exports=r},function(e,t,n){"use strict";function r(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var i=n(2),s=n(7),o={"Content-Type":"application/x-www-form-urlencoded"},a={adapter:function(){var e;return"undefined"!=typeof XMLHttpRequest?e=n(8):"undefined"!=typeof process&&(e=n(8)),e}(),transformRequest:[function(e,t){return s(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(r(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(r(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};a.headers={common:{Accept:"application/json, text/plain, */*"}},i.forEach(["delete","get","head"],function(e){a.headers[e]={}}),i.forEach(["post","put","patch"],function(e){a.headers[e]=i.merge(o)}),e.exports=a},function(e,t,n){"use strict";var r=n(2);e.exports=function(e,t){r.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})}},function(e,t,n){"use strict";var r=n(2),i=n(9),s=n(12),o=n(13),a=n(14),c=n(10),l="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||n(15);e.exports=function(e){return new Promise(function(t,d){var u=e.data,h=e.headers;r.isFormData(u)&&delete h["Content-Type"];var f=new XMLHttpRequest,p="onreadystatechange",m=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in f||a(e.url)||(f=new window.XDomainRequest,p="onload",m=!0,f.onprogress=function(){},f.ontimeout=function(){}),e.auth){var v=e.auth.username||"",g=e.auth.password||"";h.Authorization="Basic "+l(v+":"+g)}if(f.open(e.method.toUpperCase(),s(e.url,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,f[p]=function(){if(f&&(4===f.readyState||m)&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in f?o(f.getAllResponseHeaders()):null,r=e.responseType&&"text"!==e.responseType?f.response:f.responseText,s={data:r,status:1223===f.status?204:f.status,statusText:1223===f.status?"No Content":f.statusText,headers:n,config:e,request:f};i(t,d,s),f=null}},f.onerror=function(){d(c("Network Error",e,null,f)),f=null},f.ontimeout=function(){d(c("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",f)),f=null},r.isStandardBrowserEnv()){var b=n(16),w=(e.withCredentials||a(e.url))&&e.xsrfCookieName?b.read(e.xsrfCookieName):void 0;w&&(h[e.xsrfHeaderName]=w)}if("setRequestHeader"in f&&r.forEach(h,function(e,t){void 0===u&&"content-type"===t.toLowerCase()?delete h[t]:f.setRequestHeader(t,e)}),e.withCredentials&&(f.withCredentials=!0),e.responseType)try{f.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){f&&(f.abort(),d(e),f=null)}),void 0===u&&(u=null),f.send(u)})}},function(e,t,n){"use strict";var r=n(10);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){"use strict";var r=n(11);e.exports=function(e,t,n,i,s){var o=new Error(e);return r(o,t,n,i,s)}},function(e,t){"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e}},function(e,t,n){"use strict";function r(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var i=n(2);e.exports=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(i.isURLSearchParams(t))s=t.toString();else{var o=[];i.forEach(t,function(e,t){null!==e&&void 0!==e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),o.push(r(t)+"="+r(e))}))}),s=o.join("&")}return s&&(e+=(-1===e.indexOf("?")?"?":"&")+s),e}},function(e,t,n){"use strict";var r=n(2),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,s,o={};return e?(r.forEach(e.split("\n"),function(e){if(s=e.indexOf(":"),t=r.trim(e.substr(0,s)).toLowerCase(),n=r.trim(e.substr(s+1)),t){if(o[t]&&i.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}}),o):o}},function(e,t,n){"use strict";var r=n(2);e.exports=r.isStandardBrowserEnv()?function(){function e(e){var t=e;return n&&(i.setAttribute("href",t),t=i.href),i.setAttribute("href",t),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}var t,n=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");return t=e(window.location.href),function(n){var i=r.isString(n)?e(n):n;return i.protocol===t.protocol&&i.host===t.host}}():function(){return function(){return!0}}()},function(e,t){"use strict";function n(){this.message="String contains an invalid character"}function r(e){for(var t,r,s=String(e),o="",a=0,c=i;s.charAt(0|a)||(c="=",a%1);o+=c.charAt(63&t>>8-a%1*8)){if((r=s.charCodeAt(a+=.75))>255)throw new n;t=t<<8|r}return o}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.code=5,n.prototype.name="InvalidCharacterError",e.exports=r},function(e,t,n){"use strict";var r=n(2);e.exports=r.isStandardBrowserEnv()?function(){return{write:function(e,t,n,i,s,o){var a=[];a.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),r.isString(i)&&a.push("path="+i),r.isString(s)&&a.push("domain="+s),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},function(e,t,n){"use strict";function r(){this.handlers=[]}var i=n(2);r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=r},function(e,t,n){"use strict";function r(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var i=n(2),s=n(19),o=n(20),a=n(6),c=n(21),l=n(22);e.exports=function(e){return r(e),e.baseURL&&!c(e.url)&&(e.url=l(e.baseURL,e.url)),e.headers=e.headers||{},e.data=s(e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),i.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function(t){return r(e),t.data=s(t.data,t.headers,e.transformResponse),t},function(t){return o(t)||(r(e),t&&t.response&&(t.response.data=s(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,n){"use strict";var r=n(2);e.exports=function(e,t,n){return r.forEach(n,function(n){e=n(e,t)}),e}},function(e,t){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},function(e,t,n){"use strict";function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new i(e),t(n.reason))})}var i=n(23);r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r(function(t){e=t}),cancel:e}},e.exports=r},function(e,t){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}}])}),function(){function e(e){var n={r:0,g:0,b:0},i=1,o=!1,a=!1;return"string"==typeof e&&(e=M(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(n=t(e.r,e.g,e.b),o=!0,a="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=A(e.s),e.v=A(e.v),n=s(e.h,e.s,e.v),o=!0,a="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=A(e.s),e.l=A(e.l),n=r(e.h,e.s,e.l),o=!0,a="hsl"),e.hasOwnProperty("a")&&(i=e.a)),i=x(i),{ok:o,format:e.format||a,r:B(255,D(n.r,0)),g:B(255,D(n.g,0)),b:B(255,D(n.b,0)),a:i}}function t(e,t,n){return{r:255*S(e,255),g:255*S(t,255),b:255*S(n,255)}}function n(e,t,n){e=S(e,255),t=S(t,255),n=S(n,255);var r,i,s=D(e,t,n),o=B(e,t,n),a=(s+o)/2;if(s==o)r=i=0;else{var c=s-o;switch(i=a>.5?c/(2-s-o):c/(s+o),s){case e:r=(t-n)/c+(t<n?6:0);break;case t:r=(n-e)/c+2;break;case n:r=(e-t)/c+4}r/=6}return{h:r,s:i,l:a}}function r(e,t,n){function r(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var i,s,o;if(e=S(e,360),t=S(t,100),n=S(n,100),0===t)i=s=o=n;else{var a=n<.5?n*(1+t):n+t-n*t,c=2*n-a;i=r(c,a,e+1/3),s=r(c,a,e),o=r(c,a,e-1/3)}return{r:255*i,g:255*s,b:255*o}}function i(e,t,n){e=S(e,255),t=S(t,255),n=S(n,255);var r,i,s=D(e,t,n),o=B(e,t,n),a=s,c=s-o;if(i=0===s?0:c/s,s==o)r=0;else{switch(s){case e:r=(t-n)/c+(t<n?6:0);break;case t:r=(n-e)/c+2;break;case n:r=(e-t)/c+4}r/=6}return{h:r,s:i,v:a}}function s(e,t,n){e=6*S(e,360),t=S(t,100),n=S(n,100);var r=N.floor(e),i=e-r,s=n*(1-t),o=n*(1-i*t),a=n*(1-(1-i)*t),c=r%6;return{r:255*[n,o,s,s,a,n][c],g:255*[a,n,n,o,s,s][c],b:255*[s,s,a,n,n,o][c]}}function o(e,t,n,r){var i=[_(P(e).toString(16)),_(P(t).toString(16)),_(P(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function a(e,t,n,r){return[_(H(r)),_(P(e).toString(16)),_(P(t).toString(16)),_(P(n).toString(16))].join("")}function c(e,t){t=0===t?0:t||10;var n=I(e).toHsl();return n.s-=t/100,n.s=C(n.s),I(n)}function l(e,t){t=0===t?0:t||10;var n=I(e).toHsl();return n.s+=t/100,n.s=C(n.s),I(n)}function d(e){return I(e).desaturate(100)}function u(e,t){t=0===t?0:t||10;var n=I(e).toHsl();return n.l+=t/100,n.l=C(n.l),I(n)}function h(e,t){t=0===t?0:t||10;var n=I(e).toRgb();return n.r=D(0,B(255,n.r-P(-t/100*255))),n.g=D(0,B(255,n.g-P(-t/100*255))),n.b=D(0,B(255,n.b-P(-t/100*255))),I(n)}function f(e,t){t=0===t?0:t||10;var n=I(e).toHsl();return n.l-=t/100,n.l=C(n.l),I(n)}function p(e,t){var n=I(e).toHsl(),r=(P(n.h)+t)%360;return n.h=r<0?360+r:r,I(n)}function m(e){var t=I(e).toHsl();return t.h=(t.h+180)%360,I(t)}function v(e){var t=I(e).toHsl(),n=t.h;return[I(e),I({h:(n+120)%360,s:t.s,l:t.l}),I({h:(n+240)%360,s:t.s,l:t.l})]}function g(e){var t=I(e).toHsl(),n=t.h;return[I(e),I({h:(n+90)%360,s:t.s,l:t.l}),I({h:(n+180)%360,s:t.s,l:t.l}),I({h:(n+270)%360,s:t.s,l:t.l})]}function b(e){var t=I(e).toHsl(),n=t.h;return[I(e),I({h:(n+72)%360,s:t.s,l:t.l}),I({h:(n+216)%360,s:t.s,l:t.l})]}function w(e,t,n){t=t||6,n=n||30;var r=I(e).toHsl(),i=360/n,s=[I(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,s.push(I(r));return s}function y(e,t){t=t||6;for(var n=I(e).toHsv(),r=n.h,i=n.s,s=n.v,o=[],a=1/t;t--;)o.push(I({h:r,s:i,v:s})),s=(s+a)%1;return o}function x(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function S(e,t){k(e)&&(e="100%");var n=L(e);return e=B(t,D(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),N.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function C(e){return B(1,D(0,e))}function E(e){return parseInt(e,16)}function k(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)}function L(e){return"string"==typeof e&&-1!=e.indexOf("%")}function _(e){return 1==e.length?"0"+e:""+e}function A(e){return e<=1&&(e=100*e+"%"),e}function H(e){return Math.round(255*parseFloat(e)).toString(16)}function T(e){return E(e)/255}function M(e){e=e.replace(V,"").replace(R,"").toLowerCase();var t=!1;if(F[e])e=F[e],t=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=j.rgb.exec(e))?{r:n[1],g:n[2],b:n[3]}:(n=j.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=j.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=j.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=j.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=j.hex8.exec(e))?{a:T(n[1]),r:E(n[2]),g:E(n[3]),b:E(n[4]),format:t?"name":"hex8"}:(n=j.hex6.exec(e))?{r:E(n[1]),g:E(n[2]),b:E(n[3]),format:t?"name":"hex"}:!!(n=j.hex3.exec(e))&&{r:E(n[1]+""+n[1]),g:E(n[2]+""+n[2]),b:E(n[3]+""+n[3]),format:t?"name":"hex"}}var V=/^[\s,#]+/,R=/\s+$/,q=0,N=Math,P=N.round,B=N.min,D=N.max,O=N.random,I=function t(n,r){if(n=n||"",r=r||{},n instanceof t)return n;if(!(this instanceof t))return new t(n,r);var i=e(n);this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=P(100*this._a)/100,this._format=r.format||i.format,this._gradientType=r.gradientType,this._r<1&&(this._r=P(this._r)),this._g<1&&(this._g=P(this._g)),this._b<1&&(this._b=P(this._b)),this._ok=i.ok,this._tc_id=q++};I.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=x(e),this._roundA=P(100*this._a)/100,this},toHsv:function(){var e=i(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=i(this._r,this._g,this._b),t=P(360*e.h),n=P(100*e.s),r=P(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=n(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=n(this._r,this._g,this._b),t=P(360*e.h),r=P(100*e.s),i=P(100*e.l);return 1==this._a?"hsl("+t+", "+r+"%, "+i+"%)":"hsla("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return o(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return a(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:P(this._r),g:P(this._g),b:P(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+P(this._r)+", "+P(this._g)+", "+P(this._b)+")":"rgba("+P(this._r)+", "+P(this._g)+", "+P(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:P(100*S(this._r,255))+"%",g:P(100*S(this._g,255))+"%",b:P(100*S(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+P(100*S(this._r,255))+"%, "+P(100*S(this._g,255))+"%, "+P(100*S(this._b,255))+"%)":"rgba("+P(100*S(this._r,255))+"%, "+P(100*S(this._g,255))+"%, "+P(100*S(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(U[o(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+a(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";if(e){n=I(e).toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0;return t||!r||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(u,arguments)},brighten:function(){return this._applyModification(h,arguments)},darken:function(){return this._applyModification(f,arguments)},desaturate:function(){return this._applyModification(c,arguments)},saturate:function(){return this._applyModification(l,arguments)},greyscale:function(){return this._applyModification(d,arguments)},spin:function(){return this._applyModification(p,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(w,arguments)},complement:function(){return this._applyCombination(m,arguments)},monochromatic:function(){return this._applyCombination(y,arguments)},splitcomplement:function(){return this._applyCombination(b,arguments)},triad:function(){return this._applyCombination(v,arguments)},tetrad:function(){return this._applyCombination(g,arguments)}},I.fromRatio=function(e,t){if("object"==typeof e){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]="a"===r?e[r]:A(e[r]));e=n}return I(e,t)},I.equals=function(e,t){return!(!e||!t)&&I(e).toRgbString()==I(t).toRgbString()},I.random=function(){return I.fromRatio({r:O(),g:O(),b:O()})},I.mix=function(e,t,n){n=0===n?0:n||50;var r,i=I(e).toRgb(),s=I(t).toRgb(),o=n/100,a=2*o-1,c=s.a-i.a;r=a*c==-1?a:(a+c)/(1+a*c),r=(r+1)/2;var l=1-r,d={r:s.r*r+i.r*l,g:s.g*r+i.g*l,b:s.b*r+i.b*l,a:s.a*o+i.a*(1-o)};return I(d)},I.readability=function(e,t){var n=I(e),r=I(t),i=n.toRgb(),s=r.toRgb(),o=n.getBrightness(),a=r.getBrightness(),c=Math.max(i.r,s.r)-Math.min(i.r,s.r)+Math.max(i.g,s.g)-Math.min(i.g,s.g)+Math.max(i.b,s.b)-Math.min(i.b,s.b);return{brightness:Math.abs(o-a),color:c}},I.isReadable=function(e,t){var n=I.readability(e,t);return n.brightness>125&&n.color>500},I.mostReadable=function(e,t){for(var n=null,r=0,i=!1,s=0;s<t.length;s++){var o=I.readability(e,t[s]),a=o.brightness>125&&o.color>500,c=o.brightness/125*3+o.color/500;(a&&!i||a&&i&&c>r||!a&&!i&&c>r)&&(i=a,r=c,n=I(t[s]))}return n};var F=I.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},U=I.hexNames=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}(F),j=function(){
var e="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",t="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?",n="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?";return{rgb:new RegExp("rgb"+t),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+t),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+t),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();"undefined"!=typeof module&&module.exports?module.exports=I:"function"==typeof define&&define.amd?define("lib/tinycolor",[],function(){return I}):window.tinycolor=I}(),define("utils/Tools",[],function(){"use strict";return{str2ab:function(e){var t,n=new ArrayBuffer(e.length),r=new Uint8Array(n);for(t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return n},a2ab:function(e){return new Uint8Array(e).buffer},ab2hexstr:function(e){var t,n="",r=new Uint8Array(e);for(t=0;t<r.length;t++)n+=this.b2hexstr(r[t]);return n},b2hexstr:function(e){return("00"+e.toString(16)).substr(-2)},ab2str:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}),define("views/Slider",["lib/stapes"],function(e){"use strict";function t(e){var t=100*(e.value-e.min)/(e.max-e.min);e.dom.lastElementChild.style.left=t+"%"}function n(e,t){var n,r,i,s,o;n=e.touches?e.touches[0].clientX:e.clientX,r=n-t.dom.getBoundingClientRect().left,i=r/t.dom.offsetWidth,s=(t.max-t.min)*i,o=(s-t.min)%t.step,o<=t.step/2?s-=o:s+=t.step-o,s=Math.max(s,t.min),s=Math.min(s,t.max),t.value=s,t.emit("changeValue",{value:s,target:t.dom})}return e.subclass({dom:null,min:0,max:100,value:0,step:1,constructor:function(e){this.dom=e.element,this.setValue(e.value),this.setMin(e.min),this.setMax(e.max),this.setStep(e.step),this.bindEventHandlers()},bindEventHandlers:function(){function e(e){i.drag&&(n(e,i),t(i),e.preventDefault())}function r(){i.drag=!1,t(i),window.removePointerMoveHandler(document,e),window.removePointerUpHandler(document,r)}var i=this;window.addPointerDownHandler(this.dom,function(i){this.drag=!0,n(i,this),t(this),window.addPointerMoveHandler(document,e),window.addPointerUpHandler(document,r)}.bind(this))},setValue:function(e){this.value=e||0,t(this)},setMin:function(e){this.min=e||0,t(this)},setMax:function(e){this.max=e||100,t(this)},setStep:function(e){this.step=e||1,t(this)}})}),define("views/MainView",["lib/stapes","lib/tinycolor","utils/Tools","views/Slider"],function(e,t,n,r){"use strict";function i(e,t){var n,r;n=document.querySelector(".work .msg"),n||(n=document.createElement("div"),n.classList.add("msg"),n.classList.add(t),r=document.createElement("div"),r.classList.add("wrapper_msg"),r.classList.add("invisible"),r.appendChild(n),document.querySelector(".work").appendChild(r),setTimeout(function(){r.classList.remove("invisible")},0)),n.classList.contains(t)||(n.className="msg",n.classList.add(t)),n.innerHTML=e,s&&clearTimeout(s),s=setTimeout(function(){var e=document.querySelector(".work .wrapper_msg");e&&e.parentNode.removeChild(e)},1600)}var s;return e.subclass({pointer:null,colorpicker:null,slider:null,sliderinput:null,cpradius:0,cpcenter:0,drag:!1,color:null,brightness:1,inputbox:null,constructor:function(){var e;this.pointer=document.querySelector("#colorpicker #pointer"),this.colorpicker=document.querySelector("#colorpicker #colorwheelbg"),this.slider=new r({element:document.getElementById("brightness"),min:0,max:1,step:.02,value:1}),this.inputbox=document.querySelector("#color input.value"),this.cpradius=this.colorpicker.offsetWidth/2,this.cpcenter=this.colorpicker.offsetLeft+this.cpradius,this.bindEventHandlers(),e=document.createEvent("Event"),e.initEvent("resize",!0,!0),window.dispatchEvent(e)},bindEventHandlers:function(){var e;window.addEventListener("resize",function(){var e,t,n,r=this.colorpicker.parentNode.clientWidth,i=this.colorpicker.parentNode.clientHeight;e=this.colorpicker.getAttribute("width"),t=this.colorpicker.getAttribute("height"),n="auto"===e?t:e,r>i?t!==n&&(this.colorpicker.setAttribute("height",n),this.colorpicker.setAttribute("width","auto")):e!==n&&(this.colorpicker.setAttribute("height","auto"),this.colorpicker.setAttribute("width",n)),this.cpradius=this.colorpicker.offsetWidth/2,this.cpcenter=this.colorpicker.offsetLeft+this.cpradius,this.color&&this.updatePointer()}.bind(this)),window.addClickHandler(document.querySelector(".footer"),function(e){this.emit("barClick",e.target.parentNode.dataset.area)}.bind(this)),this.slider.on("changeValue",function(e){this.brightness=e.value,this.updateInput(),this.fireColorEvent()},this),this.inputbox.addEventListener("input",function(e){var n,r=new t(e.target.value).toRgb();0===r.r&&0===r.g&&0===r.b?(this.brightness=0,this.color=new t({r:255,g:255,b:255})):(n=Math.max(r.r,r.g,r.b)/256,r.r=Math.round(r.r/n),r.g=Math.round(r.g/n),r.b=Math.round(r.b/n),this.brightness=n,this.color=new t(r)),this.fireColorEvent(),this.updatePointer(),this.updateSlider()}.bind(this),!1),this.inputbox.addEventListener("keydown",function(e){switch(e.keyCode){case 8:case 9:case 16:case 37:case 38:case 39:case 40:case 46:break;default:e.target.value.length>=6&&e.target.selectionEnd-e.target.selectionStart==0?(e.preventDefault(),e.stopPropagation()):(e.keyCode<48||e.keyCode>71)&&(e.preventDefault(),e.stopPropagation())}}),e=document.querySelector("#colorpicker .touchrect"),window.addPointerDownHandler(e,function(e){this.leaveInput(),this.drag=!0,this.handleEvent(e)}.bind(this)),window.addPointerMoveHandler(e,function(e){this.drag&&(this.handleEvent(e),e.preventDefault())}.bind(this)),window.addPointerUpHandler(e,function(){this.drag=!1}.bind(this)),window.addClickHandler(document.querySelector("#clear_button"),function(){this.emit("clear")}.bind(this)),window.addClickHandler(document.querySelector("#clearall_button"),function(){this.emit("clearall")}.bind(this))},handleEvent:function(e){var t,n,r;e.touches?(n=e.touches[0].clientX,r=e.touches[0].clientY):(n=e.clientX,r=e.clientY),t=this.getCirclePoint(n,r),this.color=this.getColorFromPoint(t),this.updatePointer(),this.updateSlider(),this.updateInput(),this.fireColorEvent()},getCirclePoint:function(e,t){var n,r={x:e,y:t},i={x:this.colorpicker.offsetLeft+this.cpradius,y:this.colorpicker.offsetTop+this.cpradius};return n=Math.sqrt(Math.pow(e-i.x,2)+Math.pow(t-i.y,2)),n>this.cpradius&&(r.x=i.x+this.cpradius*((e-i.x)/n),r.y=i.y+this.cpradius*((t-i.y)/n)),r},getColorFromPoint:function(e){var n,r,i,s,o;return s=e.x-this.colorpicker.offsetLeft-this.cpradius,o=this.cpradius-e.y+this.colorpicker.offsetTop,r=Math.atan2(o,s),n=(r*(180/Math.PI)+360)%360,i=Math.min(Math.sqrt(s*s+o*o)/this.cpradius,1),new t({h:n,s:i,v:1})},getPointFromColor:function(e){var t,n,r,i={};return t=e.h*(Math.PI/180),r=Math.sin(t)*this.cpradius*e.s,n=Math.cos(t)*this.cpradius*e.s,i.x=Math.round(n+this.colorpicker.offsetLeft+this.cpradius),i.y=Math.round(this.cpradius-r+this.colorpicker.offsetTop),i},fireColorEvent:function(){var e=this.color.toRgb();e.r=Math.round(e.r*this.brightness),e.g=Math.round(e.g*this.brightness),e.b=Math.round(e.b*this.brightness),this.emit("colorChange",e)},setColor:function(e){var n;0===e.r&&0===e.g&&0===e.b?(this.brightness=0,this.color=new t({r:255,g:255,b:255})):(n=Math.max(e.r,e.g,e.b)/256,e.r=Math.round(e.r/n),e.g=Math.round(e.g/n),e.b=Math.round(e.b/n),this.brightness=n,this.color=new t(e)),this.updatePointer(),this.updateSlider(),this.updateInput()},updateSlider:function(){this.slider.setValue(this.brightness),this.slider.dom.style.backgroundImage="-webkit-linear-gradient(left, #000000 0%, "+this.color.toHexString()+" 100%)"},updatePointer:function(){var e=this.getPointFromColor(this.color.toHsv());this.pointer.style.left=e.x-this.pointer.offsetWidth/2+"px",this.pointer.style.top=e.y-this.pointer.offsetHeight/2+"px",this.pointer.style.backgroundColor=this.color.toHexString()},updateInput:function(){var e=this.color.toRgb();e.r=Math.round(e.r*this.brightness),e.g=Math.round(e.g*this.brightness),e.b=Math.round(e.b*this.brightness),this.inputbox.value=n.b2hexstr(e.r)+n.b2hexstr(e.g)+n.b2hexstr(e.b)},scrollToArea:function(e){var t,n;document.querySelector(".footer .selected").classList.remove("selected"),document.querySelector(".footer .button[data-area ="+e+"]").classList.add("selected"),t=document.getElementById(e),n=Math.floor(t.offsetLeft/t.clientWidth),t.parentNode.style.left=100*-n+"%"},showStatus:function(e){i(e,"status")},showError:function(e){i(e,"error")},leaveInput:function(){this.inputbox.blur()}})}),define("api/LocalStorage",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){},get:function(){var e;if(!window.localStorage)return void this.emit("error","Local Storage not supported");localStorage.data&&(e=JSON.parse(localStorage.data),this.emit("got",e))},set:function(e){if(!window.localStorage)return void this.emit("error","Local Storage not supported");localStorage.data=JSON.stringify(e),this.emit("set")}})}),define("models/Settings",["lib/stapes","api/LocalStorage"],function(e,t){"use strict";return e.subclass({storage:null,servers:[],constructor:function(){this.storage=new t,this.storage.on({error:function(e){this.emit("error",e)},got:function(e){e&&(this.servers=e.servers||[]),this.emit("loaded")},set:function(){this.emit("saved")}},this)},save:function(){this.storage.set({servers:this.servers})},load:function(){this.storage.get()},addServer:function(e){-1===this.indexOfServer(e)&&(0===this.servers.length&&(e.selected=!0),this.servers.push(e),this.save(),this.emit("serverAdded",e))},setSelectedServer:function(e){var t;for(t=0;t<this.servers.length;t++)delete this.servers[t].selected;this.servers[e].selected=!0,this.save(),this.emit("serverChanged",this.servers[e])},removeServer:function(e){this.servers.splice(e,1),this.save(),this.emit("serverRemoved")},updateServer:function(e,t){e>=0&&e<this.servers.length&&(this.servers[e]=t,this.save(),this.emit("serverChanged",t))},indexOfServer:function(e){var t,n;for(t=0;t<this.servers.length;t++)if(n=this.servers[t],n.port===e.port&&n.address===e.address)return t;return-1}})}),define("views/AdminView",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){this.bindEventHandlers()},bindEventHandlers:function(){window.addClickHandler(document.querySelector("#admin ul"),function(e){e.target.classList.add("selected"),setTimeout(function(){e.target.classList.remove("selected")},200),this.emit("adminSelected",e.target.dataset.id)}.bind(this))},clear:function(){document.querySelector("#admin ul").innerHTML="",document.querySelector("#admin .info").classList.add("hidden")},fillList:function(e){var t,n,r;for(t=document.createDocumentFragment(),r=0;r<e.length;r++)n=document.createElement("li"),n.innerHTML=e[r].name,n.dataset.id=e[r].path,t.appendChild(n);document.querySelector("#admin ul").appendChild(t),0===e.length&&document.querySelector("#admin .info").classList.remove("hidden")}})}),define("views/ServerList",["lib/stapes"],function(e){"use strict";function t(e){var t,n,r,i,s;return t=document.createDocumentFragment(),r=document.createElement("div"),r.classList.add("horizontal"),t.appendChild(r),s=document.createElement("div"),s.classList.add("horizontal"),r.appendChild(s),n=document.createElement("div"),n.classList.add("checkbox"),s.appendChild(n),i=document.createElement("div"),i.classList.add("titlebox"),s.appendChild(i),n=document.createElement("label"),n.classList.add("title"),n.innerHTML=e.title||"",i.appendChild(n),n=document.createElement("label"),n.classList.add("subtitle"),n.innerHTML=e.subtitle,i.appendChild(n),n=document.createElement("div"),n.classList.add("touchrect"),s.appendChild(n),n=document.createElement("div"),n.classList.add("edit_icon"),n.innerHTML="&#xe801;",r.appendChild(n),n=document.createElement("div"),n.classList.add("delete_icon"),n.innerHTML="&#xe612;",r.appendChild(n),t}function n(e){var n,r,i,s,o,a;if(n=document.createElement("div"),n.classList.add("grouplist"),n.id=e.id,a=document.createElement("div"),a.classList.add("header"),n.appendChild(a),r=document.createElement("div"),r.innerHTML=e.label,r.classList.add("title"),a.appendChild(r),r=document.createElement("div"),r.innerHTML="&#xe804;",r.classList.add("callout"),a.appendChild(r),i=document.createElement("ul"),n.appendChild(i),e.list)for(o=0;o<e.list.length;o++)s=t(e.list[o]),i.appendChild(s);return n}return e.subclass({dom:null,constructor:function(e){this.dom=n(e||{}),this.bindEventHandlers()},bindEventHandlers:function(){window.addClickHandler(this.dom.querySelector(".callout"),function(){this.emit("add")}.bind(this)),window.addClickHandler(this.dom.querySelector("ul"),function(e){e.target.classList.contains("delete_icon")?this.emit("remove",e.target.parentNode.parentNode.id):e.target.classList.contains("edit_icon")?this.emit("edit",e.target.parentNode.parentNode.id):e.target.classList.contains("touchrect")&&this.emit("select",e.target.parentNode.parentNode.parentNode.id)}.bind(this))},getDom:function(){return this.dom},append:function(e,t,n){var r=document.createElement("li");r.id=e,t&&r.classList.add("selected"),r.appendChild(n),this.dom.querySelector("ul").appendChild(r)},replace:function(e,t){var n,r=this.dom.querySelector("ul li:nth-child("+(e+1)+")");r&&(n=document.createElement("li"),n.appendChild(t),this.dom.querySelector("ul").replaceChild(n,r))},addLine:function(e){var n=t(e);this.append(e.id,e.selected,n)},clear:function(){this.dom.querySelector("ul").innerHTML=""},showAddButton:function(e){e?this.dom.querySelector(".callout").classList.remove("invisible"):this.dom.querySelector(".callout").classList.add("invisible")}})}),define("views/SettingsView",["lib/stapes","views/ServerList"],function(e,t){"use strict";function n(e){var t,n;return t=document.createElement("div"),t.classList.add("inputline"),t.id=e.id,n=document.createElement("label"),n.innerHTML=e.label,t.appendChild(n),n=document.createElement("input"),"number"==typeof e.value&&(n.type="number"),n.value=e.value||"",n.autocomplete="off",n.autocorrect="off",n.autocapitalize="off",t.appendChild(n),t}function r(e){var t,n;return t=document.createElement("div"),t.classList.add("inputline"),n=document.createElement("button"),n.innerHTML=e.label,n.classList.add("OK"),t.appendChild(n),n=document.createElement("button"),n.innerHTML="Cancel",n.classList.add("CANCEL"),t.appendChild(n),t}function i(){var e,t;return e=document.createElement("div"),e.classList.add("line"),t=document.createElement("button"),t.id="detect_button",t.innerHTML="Detect",e.appendChild(t),t=document.createElement("div"),t.classList.add("spinner"),t.classList.add("hidden"),e.appendChild(t),e}return e.subclass({dom:null,serverList:null,constructor:function(){var e,s=[];this.dom=document.querySelector("#settings"),this.serverList=new t({id:"serverList",label:"Server",list:s}),this.serverList.on({add:function(){var e,t;this.enableDetectButton(!1),this.lockList(!0),t=document.createDocumentFragment(),e=n({id:"name",label:"Name:"}),t.appendChild(e),e=n({id:"address",label:"Address:"}),t.appendChild(e),e=n({id:"port",label:"Port:",value:19444}),t.appendChild(e),e=n({id:"priority",label:"Priority:",value:50}),t.appendChild(e),e=n({id:"duration",label:"Duration (sec):",value:0}),t.appendChild(e),e=r({label:"Add"}),window.addClickHandler(e.firstChild,function(e){var t,n={},r=e.target.parentNode.parentNode.querySelectorAll("input");for(t=0;t<r.length;t++)n[r[t].parentNode.id]=r[t].value;n.port=parseInt(n.port),n.priority=parseInt(n.priority),n.duration=parseInt(n.duration),this.emit("serverAdded",n)}.bind(this)),window.addClickHandler(e.lastChild,function(){this.emit("serverAddCanceled")}.bind(this)),t.appendChild(e),this.serverList.append(null,!1,t)},select:function(e){this.dom.classList.contains("locked")||this.emit("serverSelected",parseInt(e.replace("server_","")))},remove:function(e){this.emit("serverRemoved",parseInt(e.replace("server_","")))},edit:function(e){this.emit("editServer",parseInt(e.replace("server_","")))}},this),this.dom.appendChild(this.serverList.getDom()),e=i(),window.addClickHandler(e.querySelector("button"),function(){this.emit("detect")}.bind(this)),this.dom.appendChild(e)},fillServerList:function(e){var t,n,r;for(this.serverList.clear(),t=0;t<e.length;t++)n=e[t],r={id:"server_"+t,title:n.name,subtitle:n.address+":"+n.port},n.selected&&(r.selected=!0),this.serverList.addLine(r);this.serverList.showAddButton(!0)},showWaiting:function(e){e?this.dom.querySelector(".spinner").classList.remove("hidden"):this.dom.querySelector(".spinner").classList.add("hidden")},enableDetectButton:function(e){e?this.dom.querySelector("#detect_button").classList.remove("hidden"):this.dom.querySelector("#detect_button").classList.add("hidden")},lockList:function(e){e?(this.dom.classList.add("locked"),this.serverList.showAddButton(!1)):(this.dom.classList.remove("locked"),this.serverList.showAddButton(!0))},editServer:function(e){var t,i;this.lockList(!0),this.enableDetectButton(!1),i=document.createDocumentFragment(),t=n({id:"name",label:"Name:",value:e.server.name}),i.appendChild(t),t=n({id:"address",label:"Address:",value:e.server.address}),i.appendChild(t),t=n({id:"port",label:"Port:",value:e.server.port}),i.appendChild(t),t=n({id:"priority",label:"Priority:",value:e.server.priority}),i.appendChild(t),t=n({id:"duration",label:"Duration (sec):",value:e.server.duration}),i.appendChild(t),t=r({label:"Done"}),window.addClickHandler(t.querySelector("button.OK"),function(t){var n,r={},i=t.target.parentNode.parentNode.querySelectorAll("input");for(n=0;n<i.length;n++)r[i[n].parentNode.id]=i[n].value;r.port=parseInt(r.port),r.priority=parseInt(r.priority),r.duration=parseInt(r.duration),e.server.selected&&(r.selected=!0),this.emit("serverChanged",{index:e.index,server:r})}.bind(this)),window.addClickHandler(t.querySelector("button.CANCEL"),function(){this.emit("serverEditCanceled")}.bind(this)),i.appendChild(t),window.addClickHandler(i.querySelector("input"),function(e){e.stopPropagation()}),this.serverList.replace(e.index,i)}})}),define("views/EffectsView",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){this.bindEventHandlers()},bindEventHandlers:function(){window.addClickHandler(document.querySelector("#effects ul"),function(e){var t=e.target.parentNode.querySelector(".selected");t&&t.classList.remove("selected"),e.target.classList.add("selected"),this.emit("effectSelected",e.target.dataset.id)}.bind(this))},clear:function(){document.querySelector("#effects ul").innerHTML="",document.querySelector("#effects .info").classList.add("hidden")},fillList:function(e){var t,n,r;for(t=document.createDocumentFragment(),r=0;r<e.length;r++)n=document.createElement("li"),n.innerHTML=e[r].name,n.dataset.id=e[r].id,t.appendChild(n);document.querySelector("#effects ul").appendChild(t),0===e.length&&document.querySelector("#effects .info").classList.remove("hidden")}})}),define("views/TransformView",["lib/stapes","views/Slider"],function(e,t){"use strict";function n(e){var t=e.target.parentNode.parentNode.querySelector("ul");0===t.clientHeight?(t.style.maxHeight=t.scrollHeight+"px",e.target.parentNode.parentNode.setAttribute("collapsed","false")):(t.style.maxHeight=0,e.target.parentNode.parentNode.setAttribute("collapsed","true"))}function r(e,t,n,r,i,s,o){var a,c,l,d,u;return a=document.createElement("li"),a.className=t,d=document.createElement("label"),d.innerHTML=r,a.appendChild(d),u=document.createElement("div"),u.classList.add("wrapper"),u.id=e,c=document.createElement("div"),c.classList.add("icon"),c.innerHTML=n,u.appendChild(c),c=document.createElement("div"),c.classList.add("slider"),l=document.createElement("div"),l.classList.add("track"),c.appendChild(l),l=document.createElement("div"),l.classList.add("thumb"),c.appendChild(l),c.dataset.min=s,c.dataset.max=o,c.dataset.value=i,c.dataset.step=.01,u.appendChild(c),c=document.createElement("input"),c.classList.add("value"),c.type="number",c.min=s,c.max=o,c.step=.01,c.value=parseFloat(Math.round(100*i)/100).toFixed(2),u.appendChild(c),a.appendChild(u),a}function i(e){var t,n,i,s,o;for(t=document.createElement("div"),t.classList.add("group"),e.collapsed&&t.setAttribute("collapsed","true"),t.id=e.id,n=document.createElement("div"),n.classList.add("header"),t.appendChild(n),i=document.createElement("label"),i.innerHTML=e.title,n.appendChild(i),i=document.createElement("label"),i.innerHTML=e.subtitle,n.appendChild(i),n=document.createElement("ul"),t.appendChild(n),s=0;s<e.members.length;s++)o=e.members[s],i=r(o.id,o.type,o.icon,o.label,o.value,o.min,o.max),n.appendChild(i);return t}return e.subclass({sliders:{},constructor:function(){},clear:function(){document.querySelector("#transform .values").innerHTML=""},onSliderChange:function(e){var t,n,r={};t=e.target.parentNode.id.split("_"),n=parseFloat(Math.round(100*parseFloat(e.value))/100),e.target.parentNode.querySelector(".value").value=n.toFixed(2),r[t[1]]=n,this.emit(t[0],r)},onValueChange:function(e){var t,n,r={};t=e.target.parentNode.id.split("_"),n=parseFloat(Math.round(100*parseFloat(e.target.value))/100),parseFloat(e.target.value)<parseFloat(e.target.min)?e.target.value=e.target.min:parseFloat(e.target.value)>parseFloat(e.target.max)&&(e.target.value=e.target.max),this.sliders[e.target.parentNode.id].setValue(n),r[t[1]]=n,this.emit(t[0],r)},fillList:function(e){var r,s,o,a,c;if(!e||!e.gamma)return void document.querySelector("#transform .info").classList.remove("hidden");for(r=document.createDocumentFragment(),s=i({collapsed:!0,id:"HSV",title:"HSV",subtitle:"HSV color corrections",members:[{id:"hsv_saturationGain",type:"saturation",icon:"&#xe806;",label:"Saturation gain",value:e.saturationGain,min:0,max:5},{id:"hsv_valueGain",type:"value",icon:"&#xe805;",label:"Value gain",value:e.valueGain,min:0,max:5}]}),r.appendChild(s),s=i({collapsed:!0,id:"Gamma",title:"Gamma",subtitle:"Gamma correction",members:[{id:"gamma_r",type:"red",icon:"&#xe800;",label:"Red",value:e.gamma[0],min:0,max:5},{id:"gamma_g",type:"green",icon:"&#xe800;",label:"Green",value:e.gamma[1],min:0,max:5},{id:"gamma_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.gamma[2],min:0,max:5}]}),r.appendChild(s),s=i({collapsed:!0,id:"Whitelevel",title:"Whitelevel",subtitle:"Value when RGB channel is fully on",members:[{id:"whitelevel_r",type:"red",icon:"&#xe800;",label:"Red",value:e.whitelevel[0],min:0,max:1},{id:"whitelevel_g",type:"green",icon:"&#xe800;",label:"Green",value:e.whitelevel[1],min:0,max:1},{id:"whitelevel_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.whitelevel[2],min:0,max:1}]}),r.appendChild(s),s=i({collapsed:!0,id:"Blacklevel",title:"Blacklevel",subtitle:"Value when RGB channel is fully off",members:[{id:"blacklevel_r",type:"red",icon:"&#xe800;",label:"Red",value:e.blacklevel[0],min:0,max:1},{id:"blacklevel_g",type:"green",icon:"&#xe800;",label:"Green",value:e.blacklevel[1],min:0,max:1},{id:"blacklevel_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.blacklevel[2],min:0,max:1}]}),r.appendChild(s),s=i({collapsed:!0,id:"Threshold",title:"Threshold",subtitle:"Threshold for a channel",members:[{id:"threshold_r",type:"red",icon:"&#xe800;",label:"Red",value:e.threshold[0],min:0,max:1},{id:"threshold_g",type:"green",icon:"&#xe800;",label:"Green",value:e.threshold[1],min:0,max:1},{id:"threshold_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.threshold[2],min:0,max:1}]}),r.appendChild(s),o=r.querySelectorAll(".slider"),a=0;a<o.length;a++)c=new t({element:o[a],min:o[a].dataset.min,max:o[a].dataset.max,step:o[a].dataset.step,value:o[a].dataset.value}),c.on("changeValue",this.onSliderChange,this),this.sliders[o[a].parentNode.id]=c;for(o=r.querySelectorAll("input"),a=0;a<o.length;a++)o[a].addEventListener("input",this.onValueChange.bind(this),!1);for(o=r.querySelectorAll(".header"),a=0;a<o.length;a++)window.addClickHandler(o[a],n);document.querySelector("#transform .info").classList.add("hidden"),document.querySelector("#transform .values").appendChild(r)}})}),define("data/ServerControl",["lib/stapes","utils/Tools"],function(e,t){"use strict";return e.subclass({socket:null,server:null,connecting:!1,constructor:function(e,t){this.server=e,this.socket=new t,this.connecting=!1},connect:function(){this.server?(this.connecting=!0,this.socket.create(function(){this.socket.connect(this.server,function(){this.emit("connected"),this.connecting=!1}.bind(this),function(e){this.socket.close(),this.emit("error",e),this.connecting=!1}.bind(this))}.bind(this))):this.emit("error","Missing server info")},disconnect:function(){this.socket.close()},setColor:function(e,t){var n,r;n=[Math.floor(e.r),Math.floor(e.g),Math.floor(e.b)],r={command:"color",color:n,priority:this.server.priority},t&&(r.duration=1e3*t),this.sendCommand(r)},clear:function(){var e={command:"clear",priority:this.server.priority};this.sendCommand(e)},clearall:function(){var e={command:"clearall"};this.sendCommand(e)},runEffect:function(e){var t;e&&(t={command:"effect",effect:{name:e.name,args:e.args},priority:this.server.priority},this.sendCommand(t))},setTransform:function(e){var t;e&&(t={command:"transform",transform:e},this.sendCommand(t))},sendCommand:function(e){var t;e&&(t="string"==typeof e?e:JSON.stringify(e),this.socket.isConnected(function(n){n?this.socket.write(t+"\n",function(){this.emit("cmdSent",e)}.bind(this),function(e){this.emit("error",e)}.bind(this)):this.emit("error","No server connection")}.bind(this)))},getServerInfo:function(){var e={command:"serverinfo"};this.socket.isConnected(function(n){n?this.socket.write(JSON.stringify(e)+"\n",function(){this.socket.read(function(e){var n,r=t.ab2str(e);n=JSON.parse(r),this.emit("serverInfo",n.info)}.bind(this),function(e){this.emit("error",e)}.bind(this))}.bind(this),function(e){this.emit("error",e)}.bind(this)):this.emit("error","No server connection")}.bind(this))},isConnecting:function(){return this.connecting}})}),define("api/Socket",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){},create:function(e,t){},isConnected:function(){return!1},connect:function(e,t,n){},close:function(e,t){},read:function(e,t){},write:function(e,t,n){}},!0)}),define("api/WebSocket",["lib/stapes","api/Socket","utils/Tools"],function(e,t,n){"use strict";return t.subclass({DEBUG:!1,handle:null,currentResponseCallback:null,currentErrorCallback:null,inputBuffer:null,inputBufferIndex:0,readBufferTimerId:null,constructor:function(){this.inputBuffer=new Uint8Array(4096),this.inputBufferIndex=0},create:function(e,t){this.DEBUG,e&&e()},isConnected:function(e){if(this.DEBUG,!this.handle)return this.DEBUG,void(e&&e(!1));e&&e(this.handle.readyState===WebSocket.OPEN?!0:!1)},connect:function(e,t,n){this.DEBUG,this.currentErrorCallback=n,this.handle=new WebSocket("ws://"+e.address+":"+e.port),this.handle.onmessage=this.onDataReceived.bind(this),this.handle.onclose=function(){this.DEBUG}.bind(this),this.handle.onerror=function(){this.DEBUG,this.currentErrorCallback&&(this.currentErrorCallback("WebSocket error"),this.currentErrorCallback=null)}.bind(this),this.handle.onopen=function(){t&&t()}},close:function(e,t){this.DEBUG,this.handle?(this.handle.close(),e&&e()):(this.DEBUG,t&&t("Socket handle is invalid"))},write:function(e,t,n){var r=null;if(this.DEBUG,!this.handle)return this.DEBUG,void(n&&n("Socket handle is invalid"));this.isConnected(function(i){i?(this.DEBUG,r=e,this.currentErrorCallback=n,this.handle.send(r),t&&t()):n&&n("No connection to peer")}.bind(this))},read:function(e,t){if(this.DEBUG,!this.handle)return this.DEBUG,void(t&&t("Socket handle is invalid"));this.isConnected(function(e){e||(this.currentResponseCallback=null,this.currentErrorCallback=null,t&&t("No connection to peer"))}.bind(this)),e&&(this.currentResponseCallback=e),t&&(this.currentErrorCallback=t)},onDataReceived:function(e){this.DEBUG,this.handle&&e.data&&(this.DEBUG,this.currentResponseCallback&&(this.currentResponseCallback(n.str2ab(e.data)),this.currentResponseCallback=null))}},!0)}),define("api/Network",["lib/stapes"],function(e){"use strict";return e.subclass({detectTimerId:null,constructor:function(){},getLocalInterfaces:function(e,t){var n,r=[];n=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection;var i=new n({iceServers:[]});i.onicecandidate=function(t){var n;this.detectTimerId&&clearTimeout(this.detectTimerId),t.candidate&&(n=t.candidate.candidate.split(" "),-1===r.indexOf(n[4])&&r.push(n[4])),this.detectTimerId=setTimeout(function(){e&&e(r)},200)}.bind(this),i.createDataChannel(""),i.createOffer(i.setLocalDescription.bind(i),t)},canDetectLocalAddress:function(){return window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection}},!0)}),define("controllers/AppController",["lib/stapes","lib/axios","views/MainView","models/Settings","views/AdminView","views/SettingsView","views/EffectsView","views/TransformView","data/ServerControl","api/Socket","api/Network"],function(e,t,n,r,i,s,o,a,c,l,d){"use strict";var u=new d;return e.subclass({mainView:null,adminView:null,settingsView:null,effectsView:null,transformView:null,settings:null,serverControl:null,color:{r:255,g:255,b:255},effects:[],transform:{},adminCommands:[],selectedServer:null,constructor:function(){this.mainView=new n,this.adminView=new i,this.settingsView=new s,this.effectsView=new o,this.transformView=new a,this.settings=new r,this.bindEventHandlers(),this.mainView.setColor(this.color),u.canDetectLocalAddress()||this.settingsView.enableDetectButton(!1)},init:function(){this.settings.load()},bindEventHandlers:function(){this.settings.on({loaded:function(){var e;for(e=0;e<this.settings.servers.length;e++)if(this.settings.servers[e].selected){this.selectedServer=this.settings.servers[e];break}this.settingsView.fillServerList(this.settings.servers),this.selectedServer?this.connectToServer(this.selectedServer):this.gotoArea("settings")},error:function(e){this.showError(e)},serverAdded:function(e){var t;for(t=0;t<this.settings.servers.length;t++)if(this.settings.servers[t].selected){this.selectedServer=this.settings.servers[t],this.connectToServer(e);break}this.settingsView.fillServerList(this.settings.servers)},serverChanged:function(e){var t;for(t=0;t<this.settings.servers.length;t++)if(this.settings.servers[t].selected){this.selectedServer=this.settings.servers[t],this.connectToServer(e);break}this.settingsView.fillServerList(this.settings.servers),this.connectToServer(e)},serverRemoved:function(){var e,t=!0;for(this.settingsView.fillServerList(this.settings.servers),e=0;e<this.settings.servers.length;e++)if(this.settings.servers[e].selected){t=!1;break}t&&(this.selectedServer=null,this.serverControl&&this.serverControl.disconnect(),this.effectsView.clear(),this.transformView.clear())}},this),this.mainView.on({barClick:function(e){"settings"!==e&&(this.selectedServer?this.serverControl||this.connectToServer(this.selectedServer):this.showError("No server selected")),this.gotoArea(e)},colorChange:function(e){this.color=e,this.selectedServer?this.serverControl?this.serverControl.setColor(e,this.selectedServer.duration):this.connectToServer(this.selectedServer,function(){this.serverControl.setColor(e,this.selectedServer.duration)}.bind(this)):this.showError("No server selected")},clear:function(){this.selectedServer?this.serverControl?this.serverControl.clear():this.connectToServer(this.selectedServer,function(){this.serverControl.clear()}.bind(this)):this.showError("No server selected")},clearall:function(){this.selectedServer?this.serverControl?(this.serverControl.clearall(),this.mainView.setColor({r:0,g:0,b:0})):this.connectToServer(this.selectedServer,function(){this.serverControl.clearall(),this.mainView.setColor({r:0,g:0,b:0})}.bind(this)):this.showError("No server selected")}},this),this.settingsView.on({serverAdded:function(e){e.address&&e.port?(e.priority=e.priority||50,this.settings.addServer(e),
this.lockSettingsView(!1)):this.showError("Invalid server data")},serverAddCanceled:function(){this.lockSettingsView(!1),this.settingsView.fillServerList(this.settings.servers)},serverEditCanceled:function(){this.lockSettingsView(!1),this.settingsView.fillServerList(this.settings.servers)},serverSelected:function(e){this.lockSettingsView(!1),this.settings.setSelectedServer(e)},serverRemoved:function(e){this.settings.removeServer(e)},serverChanged:function(e){e.server.address&&e.server.port?(e.server.priority=e.server.priority||50,this.settings.updateServer(e.index,e.server),this.lockSettingsView(!1)):this.showError("Invalid server data")},editServer:function(e){var t=this.settings.servers[e];this.settingsView.editServer({index:e,server:t})},durationChanged:function(e){this.settings.duration=e,this.settings.save()},detect:function(){this.lockSettingsView(!0),this.settingsView.showWaiting(!0),this.searchForServer(function(e){this.settings.addServer(e)}.bind(this),function(){this.lockSettingsView(!1),this.settingsView.showWaiting(!1)}.bind(this))}},this),this.effectsView.on({effectSelected:function(e){this.serverControl?this.serverControl.runEffect(this.effects[parseInt(e)]):this.connectToServer(this.selectedServer,function(){this.serverControl.runEffect(this.effects[parseInt(e)])}.bind(this))}},this),this.transformView.on({gamma:function(e){e.r?this.transform.gamma[0]=e.r:e.g?this.transform.gamma[1]=e.g:e.b&&(this.transform.gamma[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},whitelevel:function(e){e.r?this.transform.whitelevel[0]=e.r:e.g?this.transform.whitelevel[1]=e.g:e.b&&(this.transform.whitelevel[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},blacklevel:function(e){e.r?this.transform.blacklevel[0]=e.r:e.g?this.transform.blacklevel[1]=e.g:e.b&&(this.transform.blacklevel[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},threshold:function(e){e.r?this.transform.threshold[0]=e.r:e.g?this.transform.threshold[1]=e.g:e.b&&(this.transform.threshold[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},hsv:function(e){e.valueGain?this.transform.valueGain=e.valueGain:e.saturationGain&&(this.transform.saturationGain=e.saturationGain),this.serverControl&&this.serverControl.setTransform(this.transform)}},this),this.adminView.on({adminSelected:function(e){var n=this.selectedServer.address.indexOf(!1)?"http://":"";t.get(n+this.selectedServer.address+":19446"+e).catch(function(e){console.error(e),this.showError(e)}.bind(this))}},this)},gotoArea:function(e){this.mainView.scrollToArea(e)},connectToServer:function(e,n){if(this.serverControl){if(this.serverControl.isConnecting())return;this.serverControl.off(),this.serverControl.disconnect(),this.transformView.clear(),this.effectsView.clear(),this.adminView.clear()}var r=e.address.indexOf(!1)?"http://":"";t.get(r+e.address+":19446").then(function(e){this.adminCommands=e.data,this.updateView()}.bind(this)).catch(function(e){console.error(e),this.showError(e)}.bind(this)),this.serverControl=new c(e,l),this.serverControl.on({connected:function(){this.serverControl.getServerInfo()},serverInfo:function(e){var t;this.selectedServer.name&&0!==this.selectedServer.name.length||(this.selectedServer.name=e.hostname,t=this.settings.indexOfServer(this.selectedServer),this.settings.updateServer(t,this.selectedServer),this.settingsView.fillServerList(this.settings.servers)),e.effects.sort(function(e,t){return e.name.localeCompare(t.name)}),this.effects=e.effects,this.transform=e.transform[0],this.updateView(),this.showStatus("Connected to "+this.selectedServer.name),n&&n()},error:function(e){this.serverControl=null,this.showError(e)}},this),this.serverControl.connect()},updateView:function(){var e,t=[];if(this.effects)for(e=0;e<this.effects.length;e++)t.push({id:e,name:this.effects[e].name});this.effectsView.clear(),this.effectsView.fillList(t),this.transformView.clear(),this.transformView.fillList(this.transform),this.adminView.clear(),this.adminView.fillList(this.adminCommands)},showError:function(e){this.mainView.showError(e)},showStatus:function(e){this.mainView.showStatus(e)},lockSettingsView:function(e){u.canDetectLocalAddress()&&this.settingsView.enableDetectButton(!e),this.settingsView.lockList(e)},searchForServer:function(e,t){u.getLocalInterfaces(function(n){function r(t,n){function r(t,n,r){function i(i){var s,o;i&&e&&e(i),++u===n&&(s=t.split("."),s[3]=parseInt(s[3])+n,o=s.join("."),r(o))}var s,o,a,d,u=0;for(s=t.split("."),d=parseInt(s[3]),o=0;o<n;o++)s[3]=d+o,a=s.join("."),function(e,t,n){var r=new c({address:e,port:t},l);r.on({error:function(){r.disconnect(),n()},connected:function(){r.getServerInfo()},serverInfo:function(i){var s={address:e,port:t,priority:50};r.disconnect(),i.hostname&&(s.name=i.hostname),n(s)}}),r.connect()}(a,19444,i)}function i(e){var t,s,o=64;if(t=e.split("."),255===(s=parseInt(t[3])))return void n();s+64>254&&(o=255-s),r(e,o,i)}var s,o,a;s=1,o=t.split("."),o[3]=s,a=o.join("."),r(a,64,i)}function i(){0===n.length?t():r(n.pop(),i)}if(0===n.length)return void t();r(n.pop(),i)}.bind(this),function(e){this.showError(e)}.bind(this))}})}),requirejs.config({baseUrl:"js/app",paths:{lib:"../vendor"},map:{"controllers/AppController":{"api/Socket":"api/WebSocket"}}}),window.addPointerDownHandler=function(e,t){"use strict";e.addEventListener("touchstart",t,!1),e.addEventListener("mousedown",t,!1)},window.removePointerDownHandler=function(e,t){"use strict";e.removeEventListener("touchstart",t,!1),e.removeEventListener("mousedown",t,!1)},window.addPointerUpHandler=function(e,t){"use strict";e.addEventListener("touchend",t,!1),e.addEventListener("mouseup",t,!1)},window.removePointerUpHandler=function(e,t){"use strict";e.removeEventListener("touchend",t,!1),e.removeEventListener("mouseup",t,!1)},window.addPointerMoveHandler=function(e,t){"use strict";e.addEventListener("touchmove",t,!1),e.addEventListener("mousemove",t,!1)},window.removePointerMoveHandler=function(e,t){"use strict";e.removeEventListener("touchmove",t,!1),e.removeEventListener("mousemove",t,!1)},window.addClickHandler=function(e,t){"use strict";var n=!1;e.addEventListener("touchstart",function(e){e.touches.length>1||(n=!0)},!1),e.addEventListener("touchmove",function(){n=!1},!1),e.addEventListener("touchend",function(e){var r;n&&(t.apply(this,arguments),r=document.querySelector(":focus"),r&&e.target!==r&&r.blur(),"INPUT"!==e.target.tagName&&e.preventDefault())},!1),e.addEventListener("click",function(){t.apply(this,arguments)},!1)},require(["controllers/AppController"],function(e){"use strict";(new e).init(),navigator.mozApps&&-1!==navigator.userAgent.indexOf("Mozilla/5.0 (Mobile;")&&checkInstallFirefoxOS()}),define("main",function(){});